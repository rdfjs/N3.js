<!DOCTYPE html>

<html>
<head>
  <title>N3Store.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="IRIs.html">
                  IRIs.js
                </a>
              
                
                <a class="source" href="N3DataFactory.html">
                  N3DataFactory.js
                </a>
              
                
                <a class="source" href="N3Lexer.html">
                  N3Lexer.js
                </a>
              
                
                <a class="source" href="N3Parser.html">
                  N3Parser.js
                </a>
              
                
                <a class="source" href="N3Store.html">
                  N3Store.js
                </a>
              
                
                <a class="source" href="N3StreamParser.html">
                  N3StreamParser.js
                </a>
              
                
                <a class="source" href="N3StreamWriter.html">
                  N3StreamWriter.js
                </a>
              
                
                <a class="source" href="N3Util.html">
                  N3Util.js
                </a>
              
                
                <a class="source" href="N3Writer.html">
                  N3Writer.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>N3Store.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p><strong>N3Store</strong> objects store N3 quads by graph in memory.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Readable</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;readable-stream&#x27;</span>;
<span class="hljs-keyword">import</span> { <span class="hljs-keyword">default</span> <span class="hljs-keyword">as</span> N3DataFactory, termToId, termFromId } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./N3DataFactory&#x27;</span>;
<span class="hljs-keyword">import</span> namespaces <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./IRIs&#x27;</span>;
<span class="hljs-keyword">import</span> { isDefaultGraph } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./N3Util&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="constructor">Constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">N3Store</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">quads, options</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>The number of quads is initially zero</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span> = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p><code>_graphs</code> contains subject, predicate, and object indexes per graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p><code>_ids</code> maps entities such as <code>http://xmlns.com/foaf/0.1/name</code> to numbers,
saving memory by using only numbers as keys in <code>_graphs</code></p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span> = <span class="hljs-number">0</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>); <span class="hljs-comment">// inverse of `_ids`</span></pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p><code>_blankNodeIndex</code> is the index of the last automatically named blank node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_blankNodeIndex</span> = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Shift parameters if <code>quads</code> is not given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!options &amp;&amp; quads &amp;&amp; !quads[<span class="hljs-number">0</span>])
      options = quads, quads = <span class="hljs-literal">null</span>;
    options = options || {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span> = options.<span class="hljs-property">factory</span> || N3DataFactory;</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Add quads if passed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (quads)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addQuads</span>(quads);
  }

  <span class="hljs-title function_">_termFromId</span>(<span class="hljs-params">id, factory</span>) {
    <span class="hljs-keyword">if</span> (id[<span class="hljs-number">0</span>] === <span class="hljs-string">&#x27;.&#x27;</span>) {
      <span class="hljs-keyword">const</span> entities = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span>;
      <span class="hljs-keyword">const</span> terms = id.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;.&#x27;</span>);
      <span class="hljs-keyword">const</span> q = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>.<span class="hljs-title function_">quad</span>(
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entities[terms[<span class="hljs-number">1</span>]]),
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entities[terms[<span class="hljs-number">2</span>]]),
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entities[terms[<span class="hljs-number">3</span>]]),
        terms[<span class="hljs-number">4</span>] &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entities[terms[<span class="hljs-number">4</span>]])
      );
      <span class="hljs-keyword">return</span> q;
    }
    <span class="hljs-keyword">return</span> <span class="hljs-title function_">termFromId</span>(id, factory);
  }

  <span class="hljs-title function_">_termToNumericId</span>(<span class="hljs-params">term</span>) {
    <span class="hljs-keyword">if</span> (term.<span class="hljs-property">termType</span> === <span class="hljs-string">&#x27;Quad&#x27;</span>) {
      <span class="hljs-keyword">const</span> s = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(term.<span class="hljs-property">subject</span>),
          p = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(term.<span class="hljs-property">predicate</span>),
          o = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(term.<span class="hljs-property">object</span>);
      <span class="hljs-keyword">let</span> g;

      <span class="hljs-keyword">return</span> s &amp;&amp; p &amp;&amp; o &amp;&amp; (<span class="hljs-title function_">isDefaultGraph</span>(term.<span class="hljs-property">graph</span>) || (g = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(term.<span class="hljs-property">graph</span>))) &amp;&amp;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[g ? <span class="hljs-string">`.<span class="hljs-subst">${s}</span>.<span class="hljs-subst">${p}</span>.<span class="hljs-subst">${o}</span>.<span class="hljs-subst">${g}</span>`</span> : <span class="hljs-string">`.<span class="hljs-subst">${s}</span>.<span class="hljs-subst">${p}</span>.<span class="hljs-subst">${o}</span>`</span>];
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[<span class="hljs-title function_">termToId</span>(term)];
  }

  <span class="hljs-title function_">_termToNewNumericId</span>(<span class="hljs-params">term</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <p>This assumes that no graph term is present - we may wish to error if there is one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> str = term &amp;&amp; term.<span class="hljs-property">termType</span> === <span class="hljs-string">&#x27;Quad&#x27;</span> ?
      <span class="hljs-string">`.<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._termToNewNumericId(term.subject)}</span>.<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._termToNewNumericId(term.predicate)}</span>.<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._termToNewNumericId(term.object)}</span><span class="hljs-subst">${
        isDefaultGraph(term.graph) ? <span class="hljs-string">&#x27;&#x27;</span> : <span class="hljs-string">`.<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._termToNewNumericId(term.graph)}</span>`</span>
      }</span>`</span>
      : <span class="hljs-title function_">termToId</span>(term);

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[str] || (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span>[++<span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>] = str] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h2 id="public-properties">Public properties</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h3 id="size-returns-the-number-of-quads-in-the-store"><code>size</code> returns the number of quads in the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">get</span> <span class="hljs-title function_">size</span>() {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <p>Return the quad count if if was cached</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> size = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span>;
    <span class="hljs-keyword">if</span> (size !== <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> size;</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>Calculate the number of quads by counting to the deepest level</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    size = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>;
    <span class="hljs-keyword">let</span> subjects, subject;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> graphKey <span class="hljs-keyword">in</span> graphs)
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> subjectKey <span class="hljs-keyword">in</span> (subjects = graphs[graphKey].<span class="hljs-property">subjects</span>))
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> predicateKey <span class="hljs-keyword">in</span> (subject = subjects[subjectKey]))
          size += <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(subject[predicateKey]).<span class="hljs-property">length</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span> = size;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <h2 id="private-methods">Private methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h3 id="_addtoindex-adds-a-quad-to-a-three-layered-index"><code>_addToIndex</code> adds a quad to a three-layered index.</h3>
<p>Returns if the index has changed, if the entry did not already exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_addToIndex</span>(<span class="hljs-params">index0, key0, key1, key2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>Create layers as necessary</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> index1 = index0[key0] || (index0[key0] = {});
    <span class="hljs-keyword">const</span> index2 = index1[key1] || (index1[key1] = {});</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Setting the key to <em>any</em> value signals the presence of the quad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> existed = key2 <span class="hljs-keyword">in</span> index2;
    <span class="hljs-keyword">if</span> (!existed)
      index2[key2] = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> !existed;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <h3 id="_removefromindex-removes-a-quad-from-a-three-layered-index"><code>_removeFromIndex</code> removes a quad from a three-layered index</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_removeFromIndex</span>(<span class="hljs-params">index0, key0, key1, key2</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Remove the quad from the index</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> index1 = index0[key0], index2 = index1[key1];
    <span class="hljs-keyword">delete</span> index2[key2];</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <p>Remove intermediary index layers if they are empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> index2) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">delete</span> index1[key1];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key <span class="hljs-keyword">in</span> index1) <span class="hljs-keyword">return</span>;
    <span class="hljs-keyword">delete</span> index0[key0];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <h3 id="_findinindex-finds-a-set-of-quads-in-a-three-layered-index"><code>_findInIndex</code> finds a set of quads in a three-layered index.</h3>
<p>The index base is <code>index0</code> and the keys at each level are <code>key0</code>, <code>key1</code>, and <code>key2</code>.
Any of these keys can be undefined, which is interpreted as a wildcard.
<code>name0</code>, <code>name1</code>, and <code>name2</code> are the names of the keys at each level,
used when reconstructing the resulting quad
(for instance: <em>subject</em>, <em>predicate</em>, and <em>object</em>).
Finally, <code>graphId</code> will be the graph of the created quads.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  *<span class="hljs-title function_">_findInIndex</span>(<span class="hljs-params">index0, key0, key1, key2, name0, name1, name2, graphId</span>) {
    <span class="hljs-keyword">let</span> tmp, index1, index2;
    <span class="hljs-keyword">const</span> entityKeys = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span>;
    <span class="hljs-keyword">const</span> graph = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(graphId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>);
    <span class="hljs-keyword">const</span> parts = { <span class="hljs-attr">subject</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">predicate</span>: <span class="hljs-literal">null</span>, <span class="hljs-attr">object</span>: <span class="hljs-literal">null</span> };</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>If a key is specified, use only that part of index 0.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (key0) (tmp = index0, index0 = {})[key0] = tmp[key0];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value0 <span class="hljs-keyword">in</span> index0) {
      <span class="hljs-keyword">if</span> (index1 = index0[value0]) {
        parts[name0] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entityKeys[value0], <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>If a key is specified, use only that part of index 1.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (key1) (tmp = index1, index1 = {})[key1] = tmp[key1];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value1 <span class="hljs-keyword">in</span> index1) {
          <span class="hljs-keyword">if</span> (index2 = index1[value1]) {
            parts[name1] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entityKeys[value1], <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <p>If a key is specified, use only that part of index 2, if it exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">const</span> values = key2 ? (key2 <span class="hljs-keyword">in</span> index2 ? [key2] : []) : <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(index2);</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>Create quads for all items found in index 2.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> l = <span class="hljs-number">0</span>; l &lt; values.<span class="hljs-property">length</span>; l++) {
              parts[name2] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(entityKeys[values[l]], <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>);
              <span class="hljs-keyword">yield</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>.<span class="hljs-title function_">quad</span>(parts.<span class="hljs-property">subject</span>, parts.<span class="hljs-property">predicate</span>, parts.<span class="hljs-property">object</span>, graph);
            }
          }
        }
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <h3 id="_loop-executes-the-callback-on-all-keys-of-index-0"><code>_loop</code> executes the callback on all keys of index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_loop</span>(<span class="hljs-params">index0, callback</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> key0 <span class="hljs-keyword">in</span> index0)
      <span class="hljs-title function_">callback</span>(key0);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <h3 id="_loopbykey0-executes-the-callback-on-all-keys-of-a-certain-entry-in-index-0"><code>_loopByKey0</code> executes the callback on all keys of a certain entry in index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_loopByKey0</span>(<span class="hljs-params">index0, key0, callback</span>) {
    <span class="hljs-keyword">let</span> index1, key1;
    <span class="hljs-keyword">if</span> (index1 = index0[key0]) {
      <span class="hljs-keyword">for</span> (key1 <span class="hljs-keyword">in</span> index1)
        <span class="hljs-title function_">callback</span>(key1);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <h3 id="_loopbykey1-executes-the-callback-on-given-keys-of-all-entries-in-index-0"><code>_loopByKey1</code> executes the callback on given keys of all entries in index 0</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_loopByKey1</span>(<span class="hljs-params">index0, key1, callback</span>) {
    <span class="hljs-keyword">let</span> key0, index1;
    <span class="hljs-keyword">for</span> (key0 <span class="hljs-keyword">in</span> index0) {
      index1 = index0[key0];
      <span class="hljs-keyword">if</span> (index1[key1])
        <span class="hljs-title function_">callback</span>(key0);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <h3 id="_loopby2keys-executes-the-callback-on-given-keys-of-certain-entries-in-index-2"><code>_loopBy2Keys</code> executes the callback on given keys of certain entries in index 2</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_loopBy2Keys</span>(<span class="hljs-params">index0, key0, key1, callback</span>) {
    <span class="hljs-keyword">let</span> index1, index2, key2;
    <span class="hljs-keyword">if</span> ((index1 = index0[key0]) &amp;&amp; (index2 = index1[key1])) {
      <span class="hljs-keyword">for</span> (key2 <span class="hljs-keyword">in</span> index2)
        <span class="hljs-title function_">callback</span>(key2);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <h3 id="_countinindex-counts-matching-quads-in-a-three-layered-index"><code>_countInIndex</code> counts matching quads in a three-layered index.</h3>
<p>The index base is <code>index0</code> and the keys at each level are <code>key0</code>, <code>key1</code>, and <code>key2</code>.
Any of these keys can be undefined, which is interpreted as a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_countInIndex</span>(<span class="hljs-params">index0, key0, key1, key2</span>) {
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>, tmp, index1, index2;</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p>If a key is specified, count only that part of index 0</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (key0) (tmp = index0, index0 = {})[key0] = tmp[key0];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value0 <span class="hljs-keyword">in</span> index0) {
      <span class="hljs-keyword">if</span> (index1 = index0[value0]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p>If a key is specified, count only that part of index 1</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (key1) (tmp = index1, index1 = {})[key1] = tmp[key1];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> value1 <span class="hljs-keyword">in</span> index1) {
          <span class="hljs-keyword">if</span> (index2 = index1[value1]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p>If a key is specified, count the quad if it exists</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">if</span> (key2) (key2 <span class="hljs-keyword">in</span> index2) &amp;&amp; count++;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p>Otherwise, count all quads</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">else</span> count += <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">keys</span>(index2).<span class="hljs-property">length</span>;
          }
        }
      }
    }
    <span class="hljs-keyword">return</span> count;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <h3 id="_getgraphs-returns-an-array-with-the-given-graph"><code>_getGraphs</code> returns an array with the given graph,</h3>
<p>or all graphs if the argument is null or undefined.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_getGraphs</span>(<span class="hljs-params">graph</span>) {
    <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">isString</span>(graph))
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>;
    <span class="hljs-keyword">const</span> graphs = {};
    graphs[graph] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>[graph];
    <span class="hljs-keyword">return</span> graphs;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <h3 id="_uniqueentities-returns-a-function-that-accepts-an-entity-id"><code>_uniqueEntities</code> returns a function that accepts an entity ID</h3>
<p>and passes the corresponding entity to callback if it hasn’t occurred before.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_uniqueEntities</span>(<span class="hljs-params">callback</span>) {
    <span class="hljs-keyword">const</span> uniqueIds = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">id</span> =&gt;</span> {
      <span class="hljs-keyword">if</span> (!(id <span class="hljs-keyword">in</span> uniqueIds)) {
        uniqueIds[id] = <span class="hljs-literal">true</span>;
        <span class="hljs-title function_">callback</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termFromId</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span>[id], <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>));
      }
    };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <h2 id="public-methods">Public methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <h3 id="add-adds-the-specified-quad-to-the-dataset"><code>add</code> adds the specified quad to the dataset.</h3>
<p>Returns the dataset instance it was called on.
Existing quads, as defined in Quad.equals, will be ignored.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">add</span>(<span class="hljs-params">quad</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addQuad</span>(quad);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <h3 id="addquad-adds-a-new-quad-to-the-store"><code>addQuad</code> adds a new quad to the store.</h3>
<p>Returns if the quad index has changed, if the quad did not already exist.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">addQuad</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>Shift arguments if a quad object is given instead of components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!predicate)
      graph = subject.<span class="hljs-property">graph</span>, object = subject.<span class="hljs-property">object</span>,
        predicate = subject.<span class="hljs-property">predicate</span>, subject = subject.<span class="hljs-property">subject</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = <span class="hljs-title function_">termToId</span>(graph);</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p>Find the graph that will contain the triple</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> graphItem = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>[graph];</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <p>Create the graph if it doesn’t exist yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!graphItem) {
      graphItem = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>[graph] = { <span class="hljs-attr">subjects</span>: {}, <span class="hljs-attr">predicates</span>: {}, <span class="hljs-attr">objects</span>: {} };</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <p>Freezing a graph helps subsequent <code>add</code> performance,
and properties will never be modified anyway</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">freeze</span>(graphItem);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <p>Since entities can often be long IRIs, we avoid storing them in every index.
Instead, we have a separate index that maps entities to numbers,
which are then used as keys in the other indexes.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    subject   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNewNumericId</span>(subject);
    predicate = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNewNumericId</span>(predicate);
    object    = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNewNumericId</span>(object);

    <span class="hljs-keyword">const</span> changed = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addToIndex</span>(graphItem.<span class="hljs-property">subjects</span>,   subject,   predicate, object);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addToIndex</span>(graphItem.<span class="hljs-property">predicates</span>, predicate, object,    subject);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_addToIndex</span>(graphItem.<span class="hljs-property">objects</span>,    object,    subject,   predicate);</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p>The cached quad count is now invalid</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> changed;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <h3 id="addquads-adds-multiple-quads-to-the-store"><code>addQuads</code> adds multiple quads to the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">addQuads</span>(<span class="hljs-params">quads</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; quads.<span class="hljs-property">length</span>; i++)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addQuad</span>(quads[i]);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <h3 id="delete-removes-the-specified-quad-from-the-dataset"><code>delete</code> removes the specified quad from the dataset.</h3>
<p>Returns the dataset instance it was called on.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">delete</span>(<span class="hljs-params">quad</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeQuad</span>(quad);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <h3 id="has-determines-whether-a-dataset-includes-a-certain-quad-or-quad-pattern"><code>has</code> determines whether a dataset includes a certain quad or quad pattern.</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">has</span>(<span class="hljs-params">subjectOrQuad, predicate, object, graph</span>) {
    <span class="hljs-keyword">if</span> (subjectOrQuad &amp;&amp; subjectOrQuad.<span class="hljs-property">subject</span>)
      ({ <span class="hljs-attr">subject</span>: subjectOrQuad, predicate, object, graph } = subjectOrQuad);
    <span class="hljs-keyword">return</span> !<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readQuads</span>(subjectOrQuad, predicate, object, graph).<span class="hljs-title function_">next</span>().<span class="hljs-property">done</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <h3 id="import-adds-a-stream-of-quads-to-the-store"><code>import</code> adds a stream of quads to the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">import</span>(<span class="hljs-params">stream</span>) {
    stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">quad</span> =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">addQuad</span>(quad); });
    <span class="hljs-keyword">return</span> stream;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <h3 id="removequad-removes-a-quad-from-the-store-if-it-exists"><code>removeQuad</code> removes a quad from the store if it exists</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">removeQuad</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p>Shift arguments if a quad object is given instead of components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!predicate)
      graph = subject.<span class="hljs-property">graph</span>, object = subject.<span class="hljs-property">object</span>,
        predicate = subject.<span class="hljs-property">predicate</span>, subject = subject.<span class="hljs-property">subject</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = <span class="hljs-title function_">termToId</span>(graph);</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p>Find internal identifiers for all components
and verify the quad exists.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>;
    <span class="hljs-keyword">let</span> graphItem, subjects, predicates;
    <span class="hljs-keyword">if</span> (!(subject    = subject &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(subject)) || !(predicate = predicate &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(predicate)) ||
        !(object     = object &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(object))  || !(graphItem = graphs[graph])  ||
        !(subjects   = graphItem.<span class="hljs-property">subjects</span>[subject]) ||
        !(predicates = subjects[predicate]) ||
        !(object <span class="hljs-keyword">in</span> predicates))
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p>Remove it from all indexes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeFromIndex</span>(graphItem.<span class="hljs-property">subjects</span>,   subject,   predicate, object);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeFromIndex</span>(graphItem.<span class="hljs-property">predicates</span>, predicate, object,    subject);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeFromIndex</span>(graphItem.<span class="hljs-property">objects</span>,    object,    subject,   predicate);
    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span> !== <span class="hljs-literal">null</span>) <span class="hljs-variable language_">this</span>.<span class="hljs-property">_size</span>--;</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-56">&#x00a7;</a>
              </div>
              <p>Remove the graph if it is empty</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">for</span> (subject <span class="hljs-keyword">in</span> graphItem.<span class="hljs-property">subjects</span>) <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">delete</span> graphs[graph];
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-57">&#x00a7;</a>
              </div>
              <h3 id="removequads-removes-multiple-quads-from-the-store"><code>removeQuads</code> removes multiple quads from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">removeQuads</span>(<span class="hljs-params">quads</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; quads.<span class="hljs-property">length</span>; i++)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeQuad</span>(quads[i]);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-58">&#x00a7;</a>
              </div>
              <h3 id="remove-removes-a-stream-of-quads-from-the-store"><code>remove</code> removes a stream of quads from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">remove</span>(<span class="hljs-params">stream</span>) {
    stream.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-params">quad</span> =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeQuad</span>(quad); });
    <span class="hljs-keyword">return</span> stream;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-59">&#x00a7;</a>
              </div>
              <h3 id="removematches-removes-all-matching-quads-from-the-store"><code>removeMatches</code> removes all matching quads from the store</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">removeMatches</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Readable</span>({ <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span> });

    stream.<span class="hljs-property">_read</span> = <span class="hljs-function">() =&gt;</span> {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> quad <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readQuads</span>(subject, predicate, object, graph))
        stream.<span class="hljs-title function_">push</span>(quad);
      stream.<span class="hljs-title function_">push</span>(<span class="hljs-literal">null</span>);
    };

    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">remove</span>(stream);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-60">&#x00a7;</a>
              </div>
              <h3 id="deletegraph-removes-all-triples-with-the-given-graph-from-the-store"><code>deleteGraph</code> removes all triples with the given graph from the store</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">deleteGraph</span>(<span class="hljs-params">graph</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeMatches</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, graph);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-61">&#x00a7;</a>
              </div>
              <h3 id="getquads-returns-an-array-of-quads-matching-a-pattern"><code>getQuads</code> returns an array of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">getQuads</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">return</span> [...<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readQuads</span>(subject, predicate, object, graph)];
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-62">&#x00a7;</a>
              </div>
              <h3 id="readquads-returns-an-generator-of-quads-matching-a-pattern"><code>readQuads</code> returns an generator of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  *<span class="hljs-title function_">readQuads</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-63">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = graph &amp;&amp; <span class="hljs-title function_">termToId</span>(graph);

    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getGraphs</span>(graph);
    <span class="hljs-keyword">let</span> content, subjectId, predicateId, objectId;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-64">&#x00a7;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (subject   &amp;&amp; !(subjectId   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(subject))   ||
        predicate &amp;&amp; !(predicateId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(predicate)) ||
        object    &amp;&amp; !(objectId    = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(object)))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> graphId <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-65">&#x00a7;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graphId]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-66">&#x00a7;</a>
              </div>
              <p>Choose the optimal index, based on what fields are present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-67">&#x00a7;</a>
              </div>
              <p>If subject and object are given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_findInIndex</span>(content.<span class="hljs-property">objects</span>, objectId, subjectId, predicateId,
                              <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-68">&#x00a7;</a>
              </div>
              <p>If only subject and possibly predicate are given, the subject index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_findInIndex</span>(content.<span class="hljs-property">subjects</span>, subjectId, predicateId, <span class="hljs-literal">null</span>,
                              <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-69">&#x00a7;</a>
              </div>
              <p>If only predicate and possibly object are given, the predicate index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_findInIndex</span>(content.<span class="hljs-property">predicates</span>, predicateId, objectId, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, graphId);
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-70">&#x00a7;</a>
              </div>
              <p>If only object is given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_findInIndex</span>(content.<span class="hljs-property">objects</span>, objectId, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;object&#x27;</span>, <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, graphId);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-71">&#x00a7;</a>
              </div>
              <p>If nothing is given, iterate subjects and predicates first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_findInIndex</span>(content.<span class="hljs-property">subjects</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>,
                            <span class="hljs-string">&#x27;subject&#x27;</span>, <span class="hljs-string">&#x27;predicate&#x27;</span>, <span class="hljs-string">&#x27;object&#x27;</span>, graphId);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-72">&#x00a7;</a>
              </div>
              <h3 id="match-returns-a-new-dataset-that-is-comprised-of-all-quads-in-the-current-instance-matching-the-given-arguments"><code>match</code> returns a new dataset that is comprised of all quads in the current instance matching the given arguments.</h3>
<p>The logic described in Quad Matching is applied for each quad in this dataset to check if it should be included in the output dataset.
Note: This method always returns a new DatasetCore, even if that dataset contains no quads.
Note: Since a DatasetCore is an unordered set, the order of the quads within the returned sequence is arbitrary.
Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.
For backwards compatibility, the object return also implements the Readable stream interface.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">match</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatasetCoreAndReadableStream</span>(<span class="hljs-variable language_">this</span>, subject, predicate, object, graph);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-73">&#x00a7;</a>
              </div>
              <h3 id="countquads-returns-the-number-of-quads-matching-a-pattern"><code>countQuads</code> returns the number of quads matching a pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">countQuads</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-74">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = graph &amp;&amp; <span class="hljs-title function_">termToId</span>(graph);

    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getGraphs</span>(graph);
    <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>, content, subjectId, predicateId, objectId;</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-75">&#x00a7;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (subject   &amp;&amp; !(subjectId   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(subject))   ||
        predicate &amp;&amp; !(predicateId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(predicate)) ||
        object    &amp;&amp; !(objectId    = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(object)))
      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> graphId <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-76">&#x00a7;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graphId]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-77">&#x00a7;</a>
              </div>
              <p>Choose the optimal index, based on what fields are present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subject) {
          <span class="hljs-keyword">if</span> (object)</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-78">&#x00a7;</a>
              </div>
              <p>If subject and object are given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            count += <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_countInIndex</span>(content.<span class="hljs-property">objects</span>, objectId, subjectId, predicateId);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-79">&#x00a7;</a>
              </div>
              <p>If only subject and possibly predicate are given, the subject index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            count += <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_countInIndex</span>(content.<span class="hljs-property">subjects</span>, subjectId, predicateId, objectId);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicate) {</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-80">&#x00a7;</a>
              </div>
              <p>If only predicate and possibly object are given, the predicate index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          count += <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_countInIndex</span>(content.<span class="hljs-property">predicates</span>, predicateId, objectId, subjectId);
        }
        <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-81">&#x00a7;</a>
              </div>
              <p>If only object is possibly given, the object index will be the fastest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          count += <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_countInIndex</span>(content.<span class="hljs-property">objects</span>, objectId, subjectId, predicateId);
        }
      }
    }
    <span class="hljs-keyword">return</span> count;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-82">&#x00a7;</a>
              </div>
              <h3 id="foreach-executes-the-callback-on-all-quads"><code>forEach</code> executes the callback on all quads.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">forEach</span>(<span class="hljs-params">callback, subject, predicate, object, graph</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">quad</span> =&gt;</span> {
      <span class="hljs-title function_">callback</span>(quad);
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }, subject, predicate, object, graph);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-83">&#x00a7;</a>
              </div>
              <h3 id="every-executes-the-callback-on-all-quads"><code>every</code> executes the callback on all quads,</h3>
<p>and returns <code>true</code> if it returns truthy for all them.
Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">every</span>(<span class="hljs-params">callback, subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">let</span> some = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">const</span> every = !<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">quad</span> =&gt;</span> {
      some = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> !<span class="hljs-title function_">callback</span>(quad);
    }, subject, predicate, object, graph);
    <span class="hljs-keyword">return</span> some &amp;&amp; every;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-84">&#x00a7;</a>
              </div>
              <h3 id="some-executes-the-callback-on-all-quads"><code>some</code> executes the callback on all quads,</h3>
<p>and returns <code>true</code> if it returns truthy for any of them.
Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">some</span>(<span class="hljs-params">callback, subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> quad <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readQuads</span>(subject, predicate, object, graph))
      <span class="hljs-keyword">if</span> (<span class="hljs-title function_">callback</span>(quad))
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-85">&#x00a7;</a>
              </div>
              <h3 id="getsubjects-returns-all-subjects-that-match-the-pattern"><code>getSubjects</code> returns all subjects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">getSubjects</span>(<span class="hljs-params">predicate, object, graph</span>) {
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forSubjects</span>(<span class="hljs-function"><span class="hljs-params">s</span> =&gt;</span> { results.<span class="hljs-title function_">push</span>(s); }, predicate, object, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-86">&#x00a7;</a>
              </div>
              <h3 id="forsubjects-executes-the-callback-on-all-subjects-that-match-the-pattern"><code>forSubjects</code> executes the callback on all subjects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">forSubjects</span>(<span class="hljs-params">callback, predicate, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-87">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = graph &amp;&amp; <span class="hljs-title function_">termToId</span>(graph);

    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getGraphs</span>(graph);
    <span class="hljs-keyword">let</span> content, predicateId, objectId;
    callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_uniqueEntities</span>(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-88">&#x00a7;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (predicate &amp;&amp; !(predicateId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(predicate)) ||
        object    &amp;&amp; !(objectId    = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(object)))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-89">&#x00a7;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-90">&#x00a7;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (predicateId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-91">&#x00a7;</a>
              </div>
              <p>If predicate and object are given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopBy2Keys</span>(content.<span class="hljs-property">predicates</span>, predicateId, objectId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-92">&#x00a7;</a>
              </div>
              <p>If only predicate is given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey1</span>(content.<span class="hljs-property">subjects</span>, predicateId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-93">&#x00a7;</a>
              </div>
              <p>If only object is given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey0</span>(content.<span class="hljs-property">objects</span>, objectId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-94">&#x00a7;</a>
              </div>
              <p>If no params given, iterate all the subjects</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loop</span>(content.<span class="hljs-property">subjects</span>, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-95">&#x00a7;</a>
              </div>
              <h3 id="getpredicates-returns-all-predicates-that-match-the-pattern"><code>getPredicates</code> returns all predicates that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">getPredicates</span>(<span class="hljs-params">subject, object, graph</span>) {
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forPredicates</span>(<span class="hljs-function"><span class="hljs-params">p</span> =&gt;</span> { results.<span class="hljs-title function_">push</span>(p); }, subject, object, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-96">&#x00a7;</a>
              </div>
              <h3 id="forpredicates-executes-the-callback-on-all-predicates-that-match-the-pattern"><code>forPredicates</code> executes the callback on all predicates that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">forPredicates</span>(<span class="hljs-params">callback, subject, object, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-97">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = graph &amp;&amp; <span class="hljs-title function_">termToId</span>(graph);

    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getGraphs</span>(graph);
    <span class="hljs-keyword">let</span> content, subjectId, objectId;
    callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_uniqueEntities</span>(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-98">&#x00a7;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (subject   &amp;&amp; !(subjectId   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(subject))   ||
        object    &amp;&amp; !(objectId    = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(object)))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-99">&#x00a7;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-100">&#x00a7;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-101">&#x00a7;</a>
              </div>
              <p>If subject and object are given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopBy2Keys</span>(content.<span class="hljs-property">objects</span>, objectId, subjectId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-102">&#x00a7;</a>
              </div>
              <p>If only subject is given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey0</span>(content.<span class="hljs-property">subjects</span>, subjectId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectId)</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-103">&#x00a7;</a>
              </div>
              <p>If only object is given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey1</span>(content.<span class="hljs-property">predicates</span>, objectId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-104">&#x00a7;</a>
              </div>
              <p>If no params given, iterate all the predicates.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loop</span>(content.<span class="hljs-property">predicates</span>, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-105">&#x00a7;</a>
              </div>
              <h3 id="getobjects-returns-all-objects-that-match-the-pattern"><code>getObjects</code> returns all objects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">getObjects</span>(<span class="hljs-params">subject, predicate, graph</span>) {
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forObjects</span>(<span class="hljs-function"><span class="hljs-params">o</span> =&gt;</span> { results.<span class="hljs-title function_">push</span>(o); }, subject, predicate, graph);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-106">&#x00a7;</a>
              </div>
              <h3 id="forobjects-executes-the-callback-on-all-objects-that-match-the-pattern"><code>forObjects</code> executes the callback on all objects that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">forObjects</span>(<span class="hljs-params">callback, subject, predicate, graph</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-107">&#x00a7;</a>
              </div>
              <p>Convert terms to internal string representation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    graph = graph &amp;&amp; <span class="hljs-title function_">termToId</span>(graph);

    <span class="hljs-keyword">const</span> graphs = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getGraphs</span>(graph);
    <span class="hljs-keyword">let</span> content, subjectId, predicateId;
    callback = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_uniqueEntities</span>(callback);</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-108">&#x00a7;</a>
              </div>
              <p>Translate IRIs to internal index keys.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (subject   &amp;&amp; !(subjectId   = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(subject))   ||
        predicate &amp;&amp; !(predicateId = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_termToNumericId</span>(predicate)))
      <span class="hljs-keyword">return</span>;

    <span class="hljs-keyword">for</span> (graph <span class="hljs-keyword">in</span> graphs) {</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-109">&#x00a7;</a>
              </div>
              <p>Only if the specified graph contains triples, there can be results</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (content = graphs[graph]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-110">&#x00a7;</a>
              </div>
              <p>Choose optimal index based on which fields are wildcards</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (subjectId) {
          <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-111">&#x00a7;</a>
              </div>
              <p>If subject and predicate are given, the SPO index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopBy2Keys</span>(content.<span class="hljs-property">subjects</span>, subjectId, predicateId, callback);
          <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-112">&#x00a7;</a>
              </div>
              <p>If only subject is given, the OSP index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey1</span>(content.<span class="hljs-property">objects</span>, subjectId, callback);
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (predicateId)</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-113">&#x00a7;</a>
              </div>
              <p>If only predicate is given, the POS index is best.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loopByKey0</span>(content.<span class="hljs-property">predicates</span>, predicateId, callback);
        <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-114">&#x00a7;</a>
              </div>
              <p>If no params given, iterate all the objects.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_loop</span>(content.<span class="hljs-property">objects</span>, callback);
      }
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-115">&#x00a7;</a>
              </div>
              <h3 id="getgraphs-returns-all-graphs-that-match-the-pattern"><code>getGraphs</code> returns all graphs that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">getGraphs</span>(<span class="hljs-params">subject, predicate, object</span>) {
    <span class="hljs-keyword">const</span> results = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">forGraphs</span>(<span class="hljs-function"><span class="hljs-params">g</span> =&gt;</span> { results.<span class="hljs-title function_">push</span>(g); }, subject, predicate, object);
    <span class="hljs-keyword">return</span> results;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-116">&#x00a7;</a>
              </div>
              <h3 id="forgraphs-executes-the-callback-on-all-graphs-that-match-the-pattern"><code>forGraphs</code> executes the callback on all graphs that match the pattern.</h3>
<p>Setting any field to <code>undefined</code> or <code>null</code> indicates a wildcard.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">forGraphs</span>(<span class="hljs-params">callback, subject, predicate, object</span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> graph <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graphs</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">some</span>(<span class="hljs-function"><span class="hljs-params">quad</span> =&gt;</span> {
        <span class="hljs-title function_">callback</span>(quad.<span class="hljs-property">graph</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// Halt iteration of some()</span>
      }, subject, predicate, object, graph);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-117">&#x00a7;</a>
              </div>
              <h3 id="createblanknode-creates-a-new-blank-node-returning-its-name"><code>createBlankNode</code> creates a new blank node, returning its name</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">createBlankNode</span>(<span class="hljs-params">suggestedName</span>) {
    <span class="hljs-keyword">let</span> name, index;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-118">&#x00a7;</a>
              </div>
              <p>Generate a name based on the suggested name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (suggestedName) {
      name = suggestedName = <span class="hljs-string">`_:<span class="hljs-subst">${suggestedName}</span>`</span>, index = <span class="hljs-number">1</span>;
      <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[name])
        name = suggestedName + index++;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-119">&#x00a7;</a>
              </div>
              <p>Generate a generic blank node name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-keyword">do</span> { name = <span class="hljs-string">`_:b<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._blankNodeIndex++}</span>`</span>; }
      <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[name]);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-120">&#x00a7;</a>
              </div>
              <p>Add the blank node to the entities, avoiding the generation of duplicates</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_ids</span>[name] = ++<span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_entities</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_id</span>] = name;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_factory</span>.<span class="hljs-title function_">blankNode</span>(name.<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-121">&#x00a7;</a>
              </div>
              <h3 id="extractlists-finds-and-removes-all-list-triples"><code>extractLists</code> finds and removes all list triples</h3>
<p>and returns the items per list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">extractLists</span>(<span class="hljs-params">{ remove = <span class="hljs-literal">false</span>, ignoreErrors = <span class="hljs-literal">false</span> } = {}</span>) {
    <span class="hljs-keyword">const</span> lists = {}; <span class="hljs-comment">// has scalar keys so could be a simple Object</span>
    <span class="hljs-keyword">const</span> onError = ignoreErrors ? (<span class="hljs-function">() =&gt;</span> <span class="hljs-literal">true</span>) :
                  (<span class="hljs-function">(<span class="hljs-params">node, message</span>) =&gt;</span> { <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${node.value}</span> <span class="hljs-subst">${message}</span>`</span>); });</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-122">&#x00a7;</a>
              </div>
              <p>Traverse each list from its tail</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> tails = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getQuads</span>(<span class="hljs-literal">null</span>, namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">rest</span>, namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">nil</span>, <span class="hljs-literal">null</span>);
    <span class="hljs-keyword">const</span> toRemove = remove ? [...tails] : [];
    tails.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">tailQuad</span> =&gt;</span> {
      <span class="hljs-keyword">const</span> items = [];             <span class="hljs-comment">// the members found as objects of rdf:first quads</span>
      <span class="hljs-keyword">let</span> malformed = <span class="hljs-literal">false</span>;      <span class="hljs-comment">// signals whether the current list is malformed</span>
      <span class="hljs-keyword">let</span> head;                   <span class="hljs-comment">// the head of the list (_:b1 in above example)</span>
      <span class="hljs-keyword">let</span> headPos;                <span class="hljs-comment">// set to subject or object when head is set</span>
      <span class="hljs-keyword">const</span> graph = tailQuad.<span class="hljs-property">graph</span>; <span class="hljs-comment">// make sure list is in exactly one graph</span></pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-123">&#x00a7;</a>
              </div>
              <p>Traverse the list from tail to end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> current = tailQuad.<span class="hljs-property">subject</span>;
      <span class="hljs-keyword">while</span> (current &amp;&amp; !malformed) {
        <span class="hljs-keyword">const</span> objectQuads = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getQuads</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, current, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">const</span> subjectQuads = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getQuads</span>(current, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">let</span> quad, first = <span class="hljs-literal">null</span>, rest = <span class="hljs-literal">null</span>, parent = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-124">&#x00a7;</a>
              </div>
              <p>Find the first and rest of this list node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; subjectQuads.<span class="hljs-property">length</span> &amp;&amp; !malformed; i++) {
          quad = subjectQuads[i];
          <span class="hljs-keyword">if</span> (!quad.<span class="hljs-property">graph</span>.<span class="hljs-title function_">equals</span>(graph))
            malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;not confined to single graph&#x27;</span>);
          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (head)
            malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;has non-list arcs out&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-125">&#x00a7;</a>
              </div>
              <p>one rdf:first</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.<span class="hljs-property">predicate</span>.<span class="hljs-property">value</span> === namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">first</span>) {
            <span class="hljs-keyword">if</span> (first)
              malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;has multiple rdf:first arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              toRemove.<span class="hljs-title function_">push</span>(first = quad);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-126">&#x00a7;</a>
              </div>
              <p>one rdf:rest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.<span class="hljs-property">predicate</span>.<span class="hljs-property">value</span> === namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">rest</span>) {
            <span class="hljs-keyword">if</span> (rest)
              malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;has multiple rdf:rest arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              toRemove.<span class="hljs-title function_">push</span>(rest = quad);
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-127">&#x00a7;</a>
              </div>
              <p>alien triple</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (objectQuads.<span class="hljs-property">length</span>)
            malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;can\&#x27;t be subject and object&#x27;</span>);
          <span class="hljs-keyword">else</span> {
            head = quad; <span class="hljs-comment">// e.g. { (1 2 3) :p :o }</span>
            headPos = <span class="hljs-string">&#x27;subject&#x27;</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-128">&#x00a7;</a>
              </div>
              <p>{ :s :p (1 2) } arrives here with no head
{ (1 2) :p :o } arrives here with head set to the list.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; objectQuads.<span class="hljs-property">length</span> &amp;&amp; !malformed; ++i) {
          quad = objectQuads[i];
          <span class="hljs-keyword">if</span> (head)
            malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;can\&#x27;t have coreferences&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-129">&#x00a7;</a>
              </div>
              <p>one rdf:rest</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (quad.<span class="hljs-property">predicate</span>.<span class="hljs-property">value</span> === namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">rest</span>) {
            <span class="hljs-keyword">if</span> (parent)
              malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;has incoming rdf:rest arcs&#x27;</span>);
            <span class="hljs-keyword">else</span>
              parent = quad;
          }
          <span class="hljs-keyword">else</span> {
            head = quad; <span class="hljs-comment">// e.g. { :s :p (1 2) }</span>
            headPos = <span class="hljs-string">&#x27;object&#x27;</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-130">&#x00a7;</a>
              </div>
              <p>Store the list item and continue with parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (!first)
          malformed = <span class="hljs-title function_">onError</span>(current, <span class="hljs-string">&#x27;has no list head&#x27;</span>);
        <span class="hljs-keyword">else</span>
          items.<span class="hljs-title function_">unshift</span>(first.<span class="hljs-property">object</span>);
        current = parent &amp;&amp; parent.<span class="hljs-property">subject</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-131">&#x00a7;</a>
              </div>
              <p>Don’t remove any quads if the list is malformed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (malformed)
        remove = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-132">&#x00a7;</a>
              </div>
              <p>Store the list under the value of its head</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (head)
        lists[head[headPos].<span class="hljs-property">value</span>] = items;
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-133">&#x00a7;</a>
              </div>
              <p>Remove list quads if requested</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (remove)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">removeQuads</span>(toRemove);
    <span class="hljs-keyword">return</span> lists;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-134">&#x00a7;</a>
              </div>
              <h3 id="store-is-an-iterable">Store is an iterable.</h3>
<p>Can be used where iterables are expected: for…of loops, array spread operator,
<code>yield*</code>, and destructuring assignment (order is not guaranteed).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  *[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">readQuads</span>();
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-135">&#x00a7;</a>
              </div>
              <p>Determines whether the argument is a string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">function</span> <span class="hljs-title function_">isString</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">typeof</span> s === <span class="hljs-string">&#x27;string&#x27;</span> || s <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">String</span>;
}

<span class="hljs-comment">/**
 * A class that implements both DatasetCore and Readable.
 */</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">DatasetCoreAndReadableStream</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Readable</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">n3Store, subject, predicate, object, graph</span>) {
    <span class="hljs-variable language_">super</span>({ <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span> });
    <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">assign</span>(<span class="hljs-variable language_">this</span>, { n3Store, subject, predicate, object, graph });
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">filtered</span>() {
    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_filtered</span>) {
      <span class="hljs-keyword">const</span> { n3Store, graph, object, predicate, subject } = <span class="hljs-variable language_">this</span>;
      <span class="hljs-keyword">const</span> newStore = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_filtered</span> = <span class="hljs-keyword">new</span> <span class="hljs-title function_">N3Store</span>({ <span class="hljs-attr">factory</span>: n3Store.<span class="hljs-property">_factory</span> });
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> quad <span class="hljs-keyword">of</span> n3Store.<span class="hljs-title function_">readQuads</span>(subject, predicate, object, graph))
        newStore.<span class="hljs-title function_">addQuad</span>(quad);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_filtered</span>;
  }

  <span class="hljs-keyword">get</span> <span class="hljs-title function_">size</span>() {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">filtered</span>.<span class="hljs-property">size</span>;
  }

  <span class="hljs-title function_">_read</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> quad <span class="hljs-keyword">of</span> <span class="hljs-variable language_">this</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">push</span>(quad);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">push</span>(<span class="hljs-literal">null</span>);
  }

  <span class="hljs-title function_">add</span>(<span class="hljs-params">quad</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">filtered</span>.<span class="hljs-title function_">add</span>(quad);
  }

  <span class="hljs-title function_">delete</span>(<span class="hljs-params">quad</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">filtered</span>.<span class="hljs-title function_">delete</span>(quad);
  }

  <span class="hljs-title function_">has</span>(<span class="hljs-params">quad</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">filtered</span>.<span class="hljs-title function_">has</span>(quad);
  }

  <span class="hljs-title function_">match</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DatasetCoreAndReadableStream</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">filtered</span>, subject, predicate, object, graph);
  }

  *[<span class="hljs-title class_">Symbol</span>.<span class="hljs-property">iterator</span>]() {
    <span class="hljs-keyword">yield</span>* <span class="hljs-variable language_">this</span>.<span class="hljs-property">_filtered</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">n3Store</span>.<span class="hljs-title function_">readQuads</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">graph</span>);
  }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
