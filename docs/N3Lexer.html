<!DOCTYPE html>

<html>
<head>
  <title>N3Lexer.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="IRIs.html">
                  IRIs.js
                </a>
              
                
                <a class="source" href="N3DataFactory.html">
                  N3DataFactory.js
                </a>
              
                
                <a class="source" href="N3Lexer.html">
                  N3Lexer.js
                </a>
              
                
                <a class="source" href="N3Parser.html">
                  N3Parser.js
                </a>
              
                
                <a class="source" href="N3Store.html">
                  N3Store.js
                </a>
              
                
                <a class="source" href="N3StreamParser.html">
                  N3StreamParser.js
                </a>
              
                
                <a class="source" href="N3StreamWriter.html">
                  N3StreamWriter.js
                </a>
              
                
                <a class="source" href="N3Util.html">
                  N3Util.js
                </a>
              
                
                <a class="source" href="N3Writer.html">
                  N3Writer.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>N3Lexer.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <p><strong>N3Lexer</strong> tokenizes N3 documents.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> namespaces <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./IRIs&#x27;</span>;
<span class="hljs-keyword">import</span> queueMicrotask <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;queue-microtask&#x27;</span>;

<span class="hljs-keyword">const</span> { xsd } = namespaces;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Regular expression and replacement string to escape N3 strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> escapeSequence = <span class="hljs-regexp">/\\u([a-fA-F0-9]{4})|\\U([a-fA-F0-9]{8})|\\([^])/g</span>;
<span class="hljs-keyword">var</span> escapeReplacements = {
  <span class="hljs-string">&#x27;\\&#x27;</span>: <span class="hljs-string">&#x27;\\&#x27;</span>, <span class="hljs-string">&quot;&#x27;&quot;</span>: <span class="hljs-string">&quot;&#x27;&quot;</span>, <span class="hljs-string">&#x27;&quot;&#x27;</span>: <span class="hljs-string">&#x27;&quot;&#x27;</span>,
  <span class="hljs-string">&#x27;n&#x27;</span>: <span class="hljs-string">&#x27;\n&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>: <span class="hljs-string">&#x27;\r&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>: <span class="hljs-string">&#x27;\t&#x27;</span>, <span class="hljs-string">&#x27;f&#x27;</span>: <span class="hljs-string">&#x27;\f&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-string">&#x27;\b&#x27;</span>,
  <span class="hljs-string">&#x27;_&#x27;</span>: <span class="hljs-string">&#x27;_&#x27;</span>, <span class="hljs-string">&#x27;~&#x27;</span>: <span class="hljs-string">&#x27;~&#x27;</span>, <span class="hljs-string">&#x27;.&#x27;</span>: <span class="hljs-string">&#x27;.&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>: <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-string">&#x27;!&#x27;</span>: <span class="hljs-string">&#x27;!&#x27;</span>, <span class="hljs-string">&#x27;$&#x27;</span>: <span class="hljs-string">&#x27;$&#x27;</span>, <span class="hljs-string">&#x27;&amp;&#x27;</span>: <span class="hljs-string">&#x27;&amp;&#x27;</span>,
  <span class="hljs-string">&#x27;(&#x27;</span>: <span class="hljs-string">&#x27;(&#x27;</span>, <span class="hljs-string">&#x27;)&#x27;</span>: <span class="hljs-string">&#x27;)&#x27;</span>, <span class="hljs-string">&#x27;*&#x27;</span>: <span class="hljs-string">&#x27;*&#x27;</span>, <span class="hljs-string">&#x27;+&#x27;</span>: <span class="hljs-string">&#x27;+&#x27;</span>, <span class="hljs-string">&#x27;,&#x27;</span>: <span class="hljs-string">&#x27;,&#x27;</span>, <span class="hljs-string">&#x27;;&#x27;</span>: <span class="hljs-string">&#x27;;&#x27;</span>, <span class="hljs-string">&#x27;=&#x27;</span>: <span class="hljs-string">&#x27;=&#x27;</span>,
  <span class="hljs-string">&#x27;/&#x27;</span>: <span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;?&#x27;</span>: <span class="hljs-string">&#x27;?&#x27;</span>, <span class="hljs-string">&#x27;#&#x27;</span>: <span class="hljs-string">&#x27;#&#x27;</span>, <span class="hljs-string">&#x27;@&#x27;</span>: <span class="hljs-string">&#x27;@&#x27;</span>, <span class="hljs-string">&#x27;%&#x27;</span>: <span class="hljs-string">&#x27;%&#x27;</span>,
};
<span class="hljs-keyword">var</span> illegalIriChars = <span class="hljs-regexp">/[\x00-\x20&lt;&gt;\\&quot;\{\}\|\^\`]/</span>;

<span class="hljs-keyword">var</span> lineModeRegExps = {
  <span class="hljs-attr">_iri</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_unescapedIri</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_simpleQuotedString</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_langcode</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_blank</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_newline</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_comment</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_whitespace</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-attr">_endOfFile</span>: <span class="hljs-literal">true</span>,
};
<span class="hljs-keyword">var</span> invalidRegExp = <span class="hljs-regexp">/$0^/</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <h2 id="constructor">Constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">N3Lexer</span> </span>{
  <span class="hljs-keyword">constructor</span>(options) {</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <h2 id="regular-expressions">Regular expressions</h2>
<p>It’s slightly faster to have these as properties than as in-scope variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._iri = <span class="hljs-regexp">/^&lt;((?:[^ &lt;&gt;{}\\]|\\[uU])+)&gt;[ \t]*/</span>; <span class="hljs-comment">// IRI with escape sequences; needs sanity check after unescaping</span>
    <span class="hljs-built_in">this</span>._unescapedIri = <span class="hljs-regexp">/^&lt;([^\x00-\x20&lt;&gt;\\&quot;\{\}\|\^\`]*)&gt;[ \t]*/</span>; <span class="hljs-comment">// IRI without escape sequences; no unescaping</span>
    <span class="hljs-built_in">this</span>._simpleQuotedString = <span class="hljs-regexp">/^&quot;([^&quot;\\\r\n]*)&quot;(?=[^&quot;])/</span>; <span class="hljs-comment">// string without escape sequences</span>
    <span class="hljs-built_in">this</span>._simpleApostropheString = <span class="hljs-regexp">/^&#x27;([^&#x27;\\\r\n]*)&#x27;(?=[^&#x27;])/</span>;
    <span class="hljs-built_in">this</span>._langcode = <span class="hljs-regexp">/^@([a-z]+(?:-[a-z0-9]+)*)(?=[^a-z0-9\-])/i</span>;
    <span class="hljs-built_in">this</span>._prefix = <span class="hljs-regexp">/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:(?=[#\s&lt;])/</span>;
    <span class="hljs-built_in">this</span>._prefixed = <span class="hljs-regexp">/^((?:[A-Za-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)?:((?:(?:[0-:A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])(?:(?:[\.\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~])*(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff]|%[0-9a-fA-F]{2}|\\[!#-\/;=?\-@_~]))?)?)(?:[ \t]+|(?=\.?[,;!\^\s#()\[\]\{\}&quot;&#x27;&lt;&gt;]))/</span>;
    <span class="hljs-built_in">this</span>._variable = <span class="hljs-regexp">/^\?(?:(?:[A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:[\-0-:A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?=[.,;!\^\s#()\[\]\{\}&quot;&#x27;&lt;&gt;])/</span>;
    <span class="hljs-built_in">this</span>._blank = <span class="hljs-regexp">/^_:((?:[0-9A-Z_a-z\xc0-\xd6\xd8-\xf6\xf8-\u02ff\u0370-\u037d\u037f-\u1fff\u200c\u200d\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])(?:\.?[\-0-9A-Z_a-z\xb7\xc0-\xd6\xd8-\xf6\xf8-\u037d\u037f-\u1fff\u200c\u200d\u203f\u2040\u2070-\u218f\u2c00-\u2fef\u3001-\ud7ff\uf900-\ufdcf\ufdf0-\ufffd]|[\ud800-\udb7f][\udc00-\udfff])*)(?:[ \t]+|(?=\.?[,;:\s#()\[\]\{\}&quot;&#x27;&lt;&gt;]))/</span>;
    <span class="hljs-built_in">this</span>._number = <span class="hljs-regexp">/^[\-+]?(?:(\d+\.\d*|\.?\d+)[eE][\-+]?|\d*(\.)?)\d+(?=\.?[,;:\s#()\[\]\{\}&quot;&#x27;&lt;&gt;])/</span>;
    <span class="hljs-built_in">this</span>._boolean = <span class="hljs-regexp">/^(?:true|false)(?=[.,;\s#()\[\]\{\}&quot;&#x27;&lt;&gt;])/</span>;
    <span class="hljs-built_in">this</span>._keyword = <span class="hljs-regexp">/^@[a-z]+(?=[\s#&lt;:])/i</span>;
    <span class="hljs-built_in">this</span>._sparqlKeyword = <span class="hljs-regexp">/^(?:PREFIX|BASE|GRAPH)(?=[\s#&lt;])/i</span>;
    <span class="hljs-built_in">this</span>._shortPredicates = <span class="hljs-regexp">/^a(?=[\s()\[\]\{\}&quot;&#x27;&lt;&gt;])/</span>;
    <span class="hljs-built_in">this</span>._newline = <span class="hljs-regexp">/^[ \t]*(?:#[^\n\r]*)?(?:\r\n|\n|\r)[ \t]*/</span>;
    <span class="hljs-built_in">this</span>._comment = <span class="hljs-regexp">/#([^\n\r]*)/</span>;
    <span class="hljs-built_in">this</span>._whitespace = <span class="hljs-regexp">/^[ \t]+/</span>;
    <span class="hljs-built_in">this</span>._endOfFile = <span class="hljs-regexp">/^(?:#[^\n\r]*)?$/</span>;
    options = options || {};</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>In line mode (N-Triples or N-Quads), only simple features may be parsed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._lineMode = !!options.lineMode) {
      <span class="hljs-built_in">this</span>._n3Mode = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>Don’t tokenize special literals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> <span class="hljs-built_in">this</span>) {
        <span class="hljs-keyword">if</span> (!(key <span class="hljs-keyword">in</span> lineModeRegExps) &amp;&amp; <span class="hljs-built_in">this</span>[key] <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>)
          <span class="hljs-built_in">this</span>[key] = invalidRegExp;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>When not in line mode, enable N3 functionality by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">this</span>._n3Mode = options.n3 !== <span class="hljs-literal">false</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p>Don’t output comment tokens by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._comments = !!options.comments;</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>Cache the last tested closing position of long literals</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-built_in">this</span>._literalClosingPos = <span class="hljs-number">0</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <h2 id="private-methods">Private methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <h3 id="_tokenizetoend-tokenizes-as-for-as-possible-emitting-tokens-through-the-callback"><code>_tokenizeToEnd</code> tokenizes as for as possible, emitting tokens through the callback</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _tokenizeToEnd(callback, inputFinished) {</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>Continue parsing as far as possible; the loop will return eventually</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">var</span> input = <span class="hljs-built_in">this</span>._input, outputComments = <span class="hljs-built_in">this</span>._comments;
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Count and skip whitespace lines</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> whiteSpaceMatch, comment;
      <span class="hljs-keyword">while</span> (whiteSpaceMatch = <span class="hljs-built_in">this</span>._newline.exec(input)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-14">&#182;</a>
              </div>
              <p>Try to find a comment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (outputComments &amp;&amp; (comment = <span class="hljs-built_in">this</span>._comment.exec(whiteSpaceMatch[<span class="hljs-number">0</span>])))
          callback(<span class="hljs-literal">null</span>, { <span class="hljs-attr">line</span>: <span class="hljs-built_in">this</span>._line, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;comment&#x27;</span>, <span class="hljs-attr">value</span>: comment[<span class="hljs-number">1</span>], <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;&#x27;</span> });</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-15">&#182;</a>
              </div>
              <p>Advance the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        input = input.substr(whiteSpaceMatch[<span class="hljs-number">0</span>].length, input.length);
        <span class="hljs-built_in">this</span>._line++;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-16">&#182;</a>
              </div>
              <p>Skip whitespace on current line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!whiteSpaceMatch &amp;&amp; (whiteSpaceMatch = <span class="hljs-built_in">this</span>._whitespace.exec(input)))
        input = input.substr(whiteSpaceMatch[<span class="hljs-number">0</span>].length, input.length);</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-17">&#182;</a>
              </div>
              <p>Stop for now if we’re at the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._endOfFile.test(input)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-18">&#182;</a>
              </div>
              <p>If the input is finished, emit EOF</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (inputFinished) {</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-19">&#182;</a>
              </div>
              <p>Try to find a final comment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (outputComments &amp;&amp; (comment = <span class="hljs-built_in">this</span>._comment.exec(input)))
            callback(<span class="hljs-literal">null</span>, { <span class="hljs-attr">line</span>: <span class="hljs-built_in">this</span>._line, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;comment&#x27;</span>, <span class="hljs-attr">value</span>: comment[<span class="hljs-number">1</span>], <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;&#x27;</span> });
          callback(input = <span class="hljs-literal">null</span>, { <span class="hljs-attr">line</span>: <span class="hljs-built_in">this</span>._line, <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;eof&#x27;</span>, <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;&#x27;</span> });
        }
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._input = input;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-20">&#182;</a>
              </div>
              <p>Look for specific token types based on the first character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> line = <span class="hljs-built_in">this</span>._line, type = <span class="hljs-string">&#x27;&#x27;</span>, value = <span class="hljs-string">&#x27;&#x27;</span>, prefix = <span class="hljs-string">&#x27;&#x27;</span>,
          firstChar = input[<span class="hljs-number">0</span>], match = <span class="hljs-literal">null</span>, matchLength = <span class="hljs-number">0</span>, inconclusive = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">switch</span> (firstChar) {
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;^&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-21">&#182;</a>
              </div>
              <p>We need at least 3 tokens lookahead to distinguish ^^<IRI> and ^^pre:fixed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (input.length &lt; <span class="hljs-number">3</span>)
          <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-22">&#182;</a>
              </div>
              <p>Try to match a type</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (input[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;^&#x27;</span>) {
          <span class="hljs-built_in">this</span>._previousMarker = <span class="hljs-string">&#x27;^^&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-23">&#182;</a>
              </div>
              <p>Move to type IRI or prefixed name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          input = input.substr(<span class="hljs-number">2</span>);
          <span class="hljs-keyword">if</span> (input[<span class="hljs-number">0</span>] !== <span class="hljs-string">&#x27;&lt;&#x27;</span>) {
            inconclusive = <span class="hljs-literal">true</span>;
            <span class="hljs-keyword">break</span>;
          }
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-24">&#182;</a>
              </div>
              <p>If no type, it must be a path expression</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
          <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._n3Mode) {
            matchLength = <span class="hljs-number">1</span>;
            type = <span class="hljs-string">&#x27;^&#x27;</span>;
          }
          <span class="hljs-keyword">break</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-25">&#182;</a>
              </div>
              <p>Fall through in case the type is an IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-26">&#182;</a>
              </div>
              <p>Try to find a full IRI without escape sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._unescapedIri.exec(input))
          type = <span class="hljs-string">&#x27;IRI&#x27;</span>, value = match[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-27">&#182;</a>
              </div>
              <p>Try to find a full IRI with escape sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._iri.exec(input)) {
          value = <span class="hljs-built_in">this</span>._unescape(match[<span class="hljs-number">1</span>]);
          <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span> || illegalIriChars.test(value))
            <span class="hljs-keyword">return</span> reportSyntaxError(<span class="hljs-built_in">this</span>);
          type = <span class="hljs-string">&#x27;IRI&#x27;</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-28">&#182;</a>
              </div>
              <p>Try to find a nested triple</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (input.length &gt; <span class="hljs-number">1</span> &amp;&amp; input[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;&lt;&#x27;</span>)
          type = <span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>, matchLength = <span class="hljs-number">2</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-29">&#182;</a>
              </div>
              <p>Try to find a backwards implication arrow</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._n3Mode &amp;&amp; input.length &gt; <span class="hljs-number">1</span> &amp;&amp; input[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;=&#x27;</span>)
          type = <span class="hljs-string">&#x27;inverse&#x27;</span>, matchLength = <span class="hljs-number">2</span>, value = <span class="hljs-string">&#x27;&gt;&#x27;</span>;
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&gt;&#x27;</span>:
        <span class="hljs-keyword">if</span> (input.length &gt; <span class="hljs-number">1</span> &amp;&amp; input[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;&gt;&#x27;</span>)
          type = <span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>, matchLength = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;_&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-30">&#182;</a>
              </div>
              <p>Try to find a blank node. Since it can contain (but not end with) a dot,
we always need a non-dot character before deciding it is a blank node.
Therefore, try inserting a space if we’re at the end of the input.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((match = <span class="hljs-built_in">this</span>._blank.exec(input)) ||
            inputFinished &amp;&amp; (match = <span class="hljs-built_in">this</span>._blank.exec(input + <span class="hljs-string">&#x27; &#x27;</span>)))
          type = <span class="hljs-string">&#x27;blank&#x27;</span>, prefix = <span class="hljs-string">&#x27;_&#x27;</span>, value = match[<span class="hljs-number">1</span>];
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&quot;&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-31">&#182;</a>
              </div>
              <p>Try to find a literal without escape sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._simpleQuotedString.exec(input))
          value = match[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-32">&#182;</a>
              </div>
              <p>Try to find a literal wrapped in three pairs of quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> {
          ({ value, matchLength } = <span class="hljs-built_in">this</span>._parseLiteral(input));
          <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> reportSyntaxError(<span class="hljs-built_in">this</span>);
        }
        <span class="hljs-keyword">if</span> (match !== <span class="hljs-literal">null</span> || matchLength !== <span class="hljs-number">0</span>) {
          type = <span class="hljs-string">&#x27;literal&#x27;</span>;
          <span class="hljs-built_in">this</span>._literalClosingPos = <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;&#x27;&quot;</span>:
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._lineMode) {</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-33">&#182;</a>
              </div>
              <p>Try to find a literal without escape sequences</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._simpleApostropheString.exec(input))
            value = match[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-34">&#182;</a>
              </div>
              <p>Try to find a literal wrapped in three pairs of quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> {
            ({ value, matchLength } = <span class="hljs-built_in">this</span>._parseLiteral(input));
            <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">null</span>)
              <span class="hljs-keyword">return</span> reportSyntaxError(<span class="hljs-built_in">this</span>);
          }
          <span class="hljs-keyword">if</span> (match !== <span class="hljs-literal">null</span> || matchLength !== <span class="hljs-number">0</span>) {
            type = <span class="hljs-string">&#x27;literal&#x27;</span>;
            <span class="hljs-built_in">this</span>._literalClosingPos = <span class="hljs-number">0</span>;
          }
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;?&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-35">&#182;</a>
              </div>
              <p>Try to find a variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._n3Mode &amp;&amp; (match = <span class="hljs-built_in">this</span>._variable.exec(input)))
          type = <span class="hljs-string">&#x27;var&#x27;</span>, value = match[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;@&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-36">&#182;</a>
              </div>
              <p>Try to find a language code</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._previousMarker === <span class="hljs-string">&#x27;literal&#x27;</span> &amp;&amp; (match = <span class="hljs-built_in">this</span>._langcode.exec(input)))
          type = <span class="hljs-string">&#x27;langcode&#x27;</span>, value = match[<span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-37">&#182;</a>
              </div>
              <p>Try to find a keyword</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._keyword.exec(input))
          type = match[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-38">&#182;</a>
              </div>
              <p>Try to find a dot as punctuation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (input.length === <span class="hljs-number">1</span> ? inputFinished : (input[<span class="hljs-number">1</span>] &lt; <span class="hljs-string">&#x27;0&#x27;</span> || input[<span class="hljs-number">1</span>] &gt; <span class="hljs-string">&#x27;9&#x27;</span>)) {
          type = <span class="hljs-string">&#x27;.&#x27;</span>;
          matchLength = <span class="hljs-number">1</span>;
          <span class="hljs-keyword">break</span>;
        }</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-39">&#182;</a>
              </div>
              <p>Fall through to numerical case (could be a decimal dot)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;0&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;1&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;2&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;3&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;4&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;5&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;6&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;7&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;8&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;9&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-40">&#182;</a>
              </div>
              <p>Try to find a number. Since it can contain (but not end with) a dot,
we always need a non-dot character before deciding it is a number.
Therefore, try inserting a space if we’re at the end of the input.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._number.exec(input) ||
            inputFinished &amp;&amp; (match = <span class="hljs-built_in">this</span>._number.exec(input + <span class="hljs-string">&#x27; &#x27;</span>))) {
          type = <span class="hljs-string">&#x27;literal&#x27;</span>, value = match[<span class="hljs-number">0</span>];
          prefix = (<span class="hljs-keyword">typeof</span> match[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;string&#x27;</span> ? xsd.double :
                    (<span class="hljs-keyword">typeof</span> match[<span class="hljs-number">2</span>] === <span class="hljs-string">&#x27;string&#x27;</span> ? xsd.decimal : xsd.integer));
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;B&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;b&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;P&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;G&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;g&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-41">&#182;</a>
              </div>
              <p>Try to find a SPARQL-style keyword</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._sparqlKeyword.exec(input))
          type = match[<span class="hljs-number">0</span>].toUpperCase();
        <span class="hljs-keyword">else</span>
          inconclusive = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;f&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;t&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-42">&#182;</a>
              </div>
              <p>Try to match a boolean</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._boolean.exec(input))
          type = <span class="hljs-string">&#x27;literal&#x27;</span>, value = match[<span class="hljs-number">0</span>], prefix = xsd.boolean;
        <span class="hljs-keyword">else</span>
          inconclusive = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;a&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-43">&#182;</a>
              </div>
              <p>Try to find an abbreviated predicate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (match = <span class="hljs-built_in">this</span>._shortPredicates.exec(input))
          type = <span class="hljs-string">&#x27;abbreviation&#x27;</span>, value = <span class="hljs-string">&#x27;a&#x27;</span>;
        <span class="hljs-keyword">else</span>
          inconclusive = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;=&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-44">&#182;</a>
              </div>
              <p>Try to find an implication arrow or equals sign</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._n3Mode &amp;&amp; input.length &gt; <span class="hljs-number">1</span>) {
          type = <span class="hljs-string">&#x27;abbreviation&#x27;</span>;
          <span class="hljs-keyword">if</span> (input[<span class="hljs-number">1</span>] !== <span class="hljs-string">&#x27;&gt;&#x27;</span>)
            matchLength = <span class="hljs-number">1</span>, value = <span class="hljs-string">&#x27;=&#x27;</span>;
          <span class="hljs-keyword">else</span>
            matchLength = <span class="hljs-number">2</span>, value = <span class="hljs-string">&#x27;&gt;&#x27;</span>;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;!&#x27;</span>:
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._n3Mode)
          <span class="hljs-keyword">break</span>;
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;,&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;;&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;]&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;(&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;)&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;{&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;}&#x27;</span>:
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>._lineMode) {
          matchLength = <span class="hljs-number">1</span>;
          type = firstChar;
        }
        <span class="hljs-keyword">break</span>;

      <span class="hljs-keyword">default</span>:
        inconclusive = <span class="hljs-literal">true</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-45">&#182;</a>
              </div>
              <p>Some first characters do not allow an immediate decision, so inspect more</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (inconclusive) {</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-46">&#182;</a>
              </div>
              <p>Try to find a prefix</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> ((<span class="hljs-built_in">this</span>._previousMarker === <span class="hljs-string">&#x27;@prefix&#x27;</span> || <span class="hljs-built_in">this</span>._previousMarker === <span class="hljs-string">&#x27;PREFIX&#x27;</span>) &amp;&amp;
            (match = <span class="hljs-built_in">this</span>._prefix.exec(input)))
          type = <span class="hljs-string">&#x27;prefix&#x27;</span>, value = match[<span class="hljs-number">1</span>] || <span class="hljs-string">&#x27;&#x27;</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-47">&#182;</a>
              </div>
              <p>Try to find a prefixed name. Since it can contain (but not end with) a dot,
we always need a non-dot character before deciding it is a prefixed name.
Therefore, try inserting a space if we’re at the end of the input.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((match = <span class="hljs-built_in">this</span>._prefixed.exec(input)) ||
                 inputFinished &amp;&amp; (match = <span class="hljs-built_in">this</span>._prefixed.exec(input + <span class="hljs-string">&#x27; &#x27;</span>)))
          type = <span class="hljs-string">&#x27;prefixed&#x27;</span>, prefix = match[<span class="hljs-number">1</span>] || <span class="hljs-string">&#x27;&#x27;</span>, value = <span class="hljs-built_in">this</span>._unescape(match[<span class="hljs-number">2</span>]);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-48">&#182;</a>
              </div>
              <p>A type token is special: it can only be emitted after an IRI or prefixed name is read</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>._previousMarker === <span class="hljs-string">&#x27;^^&#x27;</span>) {
        <span class="hljs-keyword">switch</span> (type) {
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;prefixed&#x27;</span>: type = <span class="hljs-string">&#x27;type&#x27;</span>;    <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;IRI&#x27;</span>:      type = <span class="hljs-string">&#x27;typeIRI&#x27;</span>; <span class="hljs-keyword">break</span>;
        <span class="hljs-keyword">default</span>:         type = <span class="hljs-string">&#x27;&#x27;</span>;
        }
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-49">&#182;</a>
              </div>
              <p>What if nothing of the above was found?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!type) {</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-50">&#182;</a>
              </div>
              <p>We could be in streaming mode, and then we just wait for more input to arrive.
Otherwise, a syntax error has occurred in the input.
One exception: error on an unaccounted linebreak (= not inside a triple-quoted literal).</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (inputFinished || (!<span class="hljs-regexp">/^&#x27;&#x27;&#x27;|^&quot;&quot;&quot;/</span>.test(input) &amp;&amp; <span class="hljs-regexp">/\n|\r/</span>.test(input)))
          <span class="hljs-keyword">return</span> reportSyntaxError(<span class="hljs-built_in">this</span>);
        <span class="hljs-keyword">else</span>
          <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>._input = input;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-51">&#182;</a>
              </div>
              <p>Emit the parsed token</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">var</span> token = { <span class="hljs-attr">line</span>: line, <span class="hljs-attr">type</span>: type, <span class="hljs-attr">value</span>: value, <span class="hljs-attr">prefix</span>: prefix };
      callback(<span class="hljs-literal">null</span>, token);
      <span class="hljs-built_in">this</span>.previousToken = token;
      <span class="hljs-built_in">this</span>._previousMarker = type;</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-52">&#182;</a>
              </div>
              <p>Advance to next part to tokenize</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input = input.substr(matchLength || match[<span class="hljs-number">0</span>].length, input.length);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-53">&#182;</a>
              </div>
              <p>Signals the syntax error through the callback</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">reportSyntaxError</span>(<span class="hljs-params">self</span>) </span>{ callback(self._syntaxError(<span class="hljs-regexp">/^\S*/</span>.exec(input)[<span class="hljs-number">0</span>])); }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-54">&#182;</a>
              </div>
              <h3 id="_unescape-replaces-n3-escape-codes-by-their-corresponding-characters"><code>_unescape</code> replaces N3 escape codes by their corresponding characters</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _unescape(item) {
    <span class="hljs-keyword">let</span> invalid = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">const</span> replaced = item.replace(escapeSequence, <span class="hljs-function">(<span class="hljs-params">sequence, unicode4, unicode8, escapedChar</span>) =&gt;</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-55">&#182;</a>
              </div>
              <p>4-digit unicode character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> unicode4 === <span class="hljs-string">&#x27;string&#x27;</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-built_in">Number</span>.parseInt(unicode4, <span class="hljs-number">16</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-56">&#182;</a>
              </div>
              <p>8-digit unicode character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> unicode8 === <span class="hljs-string">&#x27;string&#x27;</span>) {
        <span class="hljs-keyword">let</span> charCode = <span class="hljs-built_in">Number</span>.parseInt(unicode8, <span class="hljs-number">16</span>);
        <span class="hljs-keyword">return</span> charCode &lt;= <span class="hljs-number">0xFFFF</span> ? <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-built_in">Number</span>.parseInt(unicode8, <span class="hljs-number">16</span>)) :
          <span class="hljs-built_in">String</span>.fromCharCode(<span class="hljs-number">0xD800</span> + ((charCode -= <span class="hljs-number">0x10000</span>) &gt;&gt; <span class="hljs-number">10</span>), <span class="hljs-number">0xDC00</span> + (charCode &amp; <span class="hljs-number">0x3FF</span>));
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-57">&#182;</a>
              </div>
              <p>fixed escape sequence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (escapedChar <span class="hljs-keyword">in</span> escapeReplacements)
        <span class="hljs-keyword">return</span> escapeReplacements[escapedChar];</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-58">&#182;</a>
              </div>
              <p>invalid escape sequence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      invalid = <span class="hljs-literal">true</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&#x27;</span>;
    });
    <span class="hljs-keyword">return</span> invalid ? <span class="hljs-literal">null</span> : replaced;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-59">&#182;</a>
              </div>
              <h3 id="_parseliteral-parses-a-literal-into-an-unescaped-value"><code>_parseLiteral</code> parses a literal into an unescaped value</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _parseLiteral(input) {</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-60">&#182;</a>
              </div>
              <p>Ensure we have enough lookahead to identify triple-quoted strings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (input.length &gt;= <span class="hljs-number">3</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-61">&#182;</a>
              </div>
              <p>Identify the opening quote(s)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> opening = input.match(<span class="hljs-regexp">/^(?:&quot;&quot;&quot;|&quot;|&#x27;&#x27;&#x27;|&#x27;|)/</span>)[<span class="hljs-number">0</span>];
      <span class="hljs-keyword">const</span> openingLength = opening.length;</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-62">&#182;</a>
              </div>
              <p>Find the next candidate closing quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">let</span> closingPos = <span class="hljs-built_in">Math</span>.max(<span class="hljs-built_in">this</span>._literalClosingPos, openingLength);
      <span class="hljs-keyword">while</span> ((closingPos = input.indexOf(opening, closingPos)) &gt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-63">&#182;</a>
              </div>
              <p>Count backslashes right before the closing quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">let</span> backslashCount = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">while</span> (input[closingPos - backslashCount - <span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;\\&#x27;</span>)
          backslashCount++;</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-64">&#182;</a>
              </div>
              <p>An even number of backslashes (in particular 0)
means these are actual, non-escaped closing quotes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (backslashCount % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-65">&#182;</a>
              </div>
              <p>Extract and unescape the value</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">const</span> raw = input.substring(openingLength, closingPos);
          <span class="hljs-keyword">const</span> lines = raw.split(<span class="hljs-regexp">/\r\n|\r|\n/</span>).length - <span class="hljs-number">1</span>;
          <span class="hljs-keyword">const</span> matchLength = closingPos + openingLength;</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-66">&#182;</a>
              </div>
              <p>Only triple-quoted strings can be multi-line</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (openingLength === <span class="hljs-number">1</span> &amp;&amp; lines !== <span class="hljs-number">0</span> ||
              openingLength === <span class="hljs-number">3</span> &amp;&amp; <span class="hljs-built_in">this</span>._lineMode)
            <span class="hljs-keyword">break</span>;
          <span class="hljs-built_in">this</span>._line += lines;
          <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-built_in">this</span>._unescape(raw), matchLength };
        }
        closingPos++;
      }
      <span class="hljs-built_in">this</span>._literalClosingPos = input.length - openingLength + <span class="hljs-number">1</span>;
    }
    <span class="hljs-keyword">return</span> { <span class="hljs-attr">value</span>: <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-attr">matchLength</span>: <span class="hljs-number">0</span> };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-67">&#182;</a>
              </div>
              <h3 id="_syntaxerror-creates-a-syntax-error-for-the-given-issue"><code>_syntaxError</code> creates a syntax error for the given issue</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  _syntaxError(issue) {
    <span class="hljs-built_in">this</span>._input = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">&#x27;Unexpected &quot;&#x27;</span> + issue + <span class="hljs-string">&#x27;&quot; on line &#x27;</span> + <span class="hljs-built_in">this</span>._line + <span class="hljs-string">&#x27;.&#x27;</span>);
    err.context = {
      <span class="hljs-attr">token</span>: <span class="hljs-literal">undefined</span>,
      <span class="hljs-attr">line</span>: <span class="hljs-built_in">this</span>._line,
      <span class="hljs-attr">previousToken</span>: <span class="hljs-built_in">this</span>.previousToken,
    };
    <span class="hljs-keyword">return</span> err;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-68">&#182;</a>
              </div>
              <h2 id="public-methods">Public methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-69">&#182;</a>
              </div>
              <h3 id="tokenize-starts-the-transformation-of-an-n3-document-into-an-array-of-tokens"><code>tokenize</code> starts the transformation of an N3 document into an array of tokens.</h3>
<p>The input can be a string or a stream.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  tokenize(input, callback) {
    <span class="hljs-keyword">var</span> self = <span class="hljs-built_in">this</span>;
    <span class="hljs-built_in">this</span>._line = <span class="hljs-number">1</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-70">&#182;</a>
              </div>
              <p>If the input is a string, continuously emit tokens through the callback until the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input === <span class="hljs-string">&#x27;string&#x27;</span>) {
      <span class="hljs-built_in">this</span>._input = input;</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-71">&#182;</a>
              </div>
              <p>If a callback was passed, asynchronously call it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">&#x27;function&#x27;</span>)
        queueMicrotask(<span class="hljs-function">() =&gt;</span> self._tokenizeToEnd(callback, <span class="hljs-literal">true</span>));</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-72">&#182;</a>
              </div>
              <p>If no callback was passed, tokenize synchronously and return</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">var</span> tokens = [], error;
        <span class="hljs-built_in">this</span>._tokenizeToEnd(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e, t</span>) </span>{ e ? (error = e) : tokens.push(t); }, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
        <span class="hljs-keyword">return</span> tokens;
      }
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-73">&#182;</a>
              </div>
              <p>Otherwise, the input must be a stream</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-built_in">this</span>._input = <span class="hljs-string">&#x27;&#x27;</span>;
      <span class="hljs-built_in">this</span>._pendingBuffer = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> input.setEncoding === <span class="hljs-string">&#x27;function&#x27;</span>)
        input.setEncoding(<span class="hljs-string">&#x27;utf8&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-74">&#182;</a>
              </div>
              <p>Adds the data chunk to the buffer and parses as far as possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input.on(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">if</span> (self._input !== <span class="hljs-literal">null</span> &amp;&amp; data.length !== <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-75">&#182;</a>
              </div>
              <p>Prepend any previous pending writes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (self._pendingBuffer) {
            data = Buffer.concat([self._pendingBuffer, data]);
            self._pendingBuffer = <span class="hljs-literal">null</span>;
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-76">&#182;</a>
              </div>
              <p>Hold if the buffer ends in an incomplete unicode sequence</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (data[data.length - <span class="hljs-number">1</span>] &amp; <span class="hljs-number">0x80</span>) {
            self._pendingBuffer = data;
          }</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-77">&#182;</a>
              </div>
              <p>Otherwise, tokenize as far as possible</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">else</span> {
            self._input += data;
            self._tokenizeToEnd(callback, <span class="hljs-literal">false</span>);
          }
        }
      });</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-78">&#182;</a>
              </div>
              <p>Parses until the end</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      input.on(<span class="hljs-string">&#x27;end&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (self._input !== <span class="hljs-literal">null</span>)
          self._tokenizeToEnd(callback, <span class="hljs-literal">true</span>);
      });
      input.on(<span class="hljs-string">&#x27;error&#x27;</span>, callback);
    }
  }
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
