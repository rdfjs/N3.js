<!DOCTYPE html>

<html>
<head>
  <title>N3Parser.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page_wrapper">
            <div id="jump_page">
              
                
                <a class="source" href="IRIs.html">
                  IRIs.js
                </a>
              
                
                <a class="source" href="N3DataFactory.html">
                  N3DataFactory.js
                </a>
              
                
                <a class="source" href="N3Lexer.html">
                  N3Lexer.js
                </a>
              
                
                <a class="source" href="N3Parser.html">
                  N3Parser.js
                </a>
              
                
                <a class="source" href="N3Store.html">
                  N3Store.js
                </a>
              
                
                <a class="source" href="N3StreamParser.html">
                  N3StreamParser.js
                </a>
              
                
                <a class="source" href="N3StreamWriter.html">
                  N3StreamWriter.js
                </a>
              
                
                <a class="source" href="N3Util.html">
                  N3Util.js
                </a>
              
                
                <a class="source" href="N3Writer.html">
                  N3Writer.js
                </a>
              
                
                <a class="source" href="index.html">
                  index.js
                </a>
              
            </div>
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>N3Parser.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-1">&#x00a7;</a>
              </div>
              <p><strong>N3Parser</strong> parses N3 documents.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">import</span> N3Lexer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./N3Lexer&#x27;</span>;
<span class="hljs-keyword">import</span> N3DataFactory <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./N3DataFactory&#x27;</span>;
<span class="hljs-keyword">import</span> namespaces <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./IRIs&#x27;</span>;

<span class="hljs-keyword">let</span> blankNodePrefix = <span class="hljs-number">0</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-2">&#x00a7;</a>
              </div>
              <h2 id="constructor">Constructor</h2>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">N3Parser</span> {
  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">options</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span> = [];
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-3">&#x00a7;</a>
              </div>
              <p>Set the document IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    options = options || {};
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_setBase</span>(options.<span class="hljs-property">baseIRI</span>);
    options.<span class="hljs-property">factory</span> &amp;&amp; <span class="hljs-title function_">initDataFactory</span>(<span class="hljs-variable language_">this</span>, options.<span class="hljs-property">factory</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-4">&#x00a7;</a>
              </div>
              <p>Set supported features depending on the format</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> format = (<span class="hljs-keyword">typeof</span> options.<span class="hljs-property">format</span> === <span class="hljs-string">&#x27;string&#x27;</span>) ?
                 options.<span class="hljs-property">format</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/\w*$/</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">toLowerCase</span>() : <span class="hljs-string">&#x27;&#x27;</span>,
        isTurtle = <span class="hljs-regexp">/turtle/</span>.<span class="hljs-title function_">test</span>(format), isTriG = <span class="hljs-regexp">/trig/</span>.<span class="hljs-title function_">test</span>(format),
        isNTriples = <span class="hljs-regexp">/triple/</span>.<span class="hljs-title function_">test</span>(format), isNQuads = <span class="hljs-regexp">/quad/</span>.<span class="hljs-title function_">test</span>(format),
        isN3 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span> = <span class="hljs-regexp">/n3/</span>.<span class="hljs-title function_">test</span>(format),
        isLineMode = isNTriples || isNQuads;
    <span class="hljs-keyword">if</span> (!(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsNamedGraphs</span> = !(isTurtle || isN3)))
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateOrNamedGraph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-5">&#x00a7;</a>
              </div>
              <p>Support triples in other graphs</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsQuads</span> = !(isTurtle || isTriG || isNTriples || isN3);</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-6">&#x00a7;</a>
              </div>
              <p>Support nesting of triples</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsRDFStar</span> = format === <span class="hljs-string">&#x27;&#x27;</span> || <span class="hljs-regexp">/star|\*$/</span>.<span class="hljs-title function_">test</span>(format);</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-7">&#x00a7;</a>
              </div>
              <p>Disable relative IRIs in N-Triples or N-Quads mode</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (isLineMode)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_resolveRelativeIRI</span> = <span class="hljs-function"><span class="hljs-params">iri</span> =&gt;</span> { <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>; };
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_blankNodePrefix</span> = <span class="hljs-keyword">typeof</span> options.<span class="hljs-property">blankNodePrefix</span> !== <span class="hljs-string">&#x27;string&#x27;</span> ? <span class="hljs-string">&#x27;&#x27;</span> :
                              options.<span class="hljs-property">blankNodePrefix</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^(?!_:)/</span>, <span class="hljs-string">&#x27;_:&#x27;</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_lexer</span> = options.<span class="hljs-property">lexer</span> || <span class="hljs-keyword">new</span> <span class="hljs-title function_">N3Lexer</span>({ <span class="hljs-attr">lineMode</span>: isLineMode, <span class="hljs-attr">n3</span>: isN3 });</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-8">&#x00a7;</a>
              </div>
              <p>Disable explicit quantifiers by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_explicitQuantifiers</span> = !!options.<span class="hljs-property">explicitQuantifiers</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-9">&#x00a7;</a>
              </div>
              <h2 id="static-class-methods">Static class methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-10">&#x00a7;</a>
              </div>
              <h3 id="_resetblanknodeprefix-restarts-blank-node-prefix-identification"><code>_resetBlankNodePrefix</code> restarts blank node prefix identification</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">_resetBlankNodePrefix</span>(<span class="hljs-params"></span>) {
    blankNodePrefix = <span class="hljs-number">0</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-11">&#x00a7;</a>
              </div>
              <h2 id="private-methods">Private methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-12">&#x00a7;</a>
              </div>
              <h3 id="_setbase-sets-the-base-iri-to-resolve-relative-iris"><code>_setBase</code> sets the base IRI to resolve relative IRIs</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_setBase</span>(<span class="hljs-params">baseIRI</span>) {
    <span class="hljs-keyword">if</span> (!baseIRI) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_base</span> = <span class="hljs-string">&#x27;&#x27;</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePath</span> = <span class="hljs-string">&#x27;&#x27;</span>;
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-13">&#x00a7;</a>
              </div>
              <p>Remove fragment if present</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> fragmentPos = baseIRI.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;#&#x27;</span>);
      <span class="hljs-keyword">if</span> (fragmentPos &gt;= <span class="hljs-number">0</span>)
        baseIRI = baseIRI.<span class="hljs-title function_">substr</span>(<span class="hljs-number">0</span>, fragmentPos);</pre></div></div>
            
        </li>
        
        
        <li id="section-14">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-14">&#x00a7;</a>
              </div>
              <p>Set base IRI and its components</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_base</span> = baseIRI;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePath</span>   = baseIRI.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;/&#x27;</span>) &lt; <span class="hljs-number">0</span> ? baseIRI :
                         baseIRI.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/[^\/?]*(?:\?.*)?$/</span>, <span class="hljs-string">&#x27;&#x27;</span>);
      baseIRI = baseIRI.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/^(?:([a-z][a-z0-9+.-]*:))?(?:\/\/[^\/]*)?/i</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_baseRoot</span>   = baseIRI[<span class="hljs-number">0</span>];
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_baseScheme</span> = baseIRI[<span class="hljs-number">1</span>];
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-15">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-15">&#x00a7;</a>
              </div>
              <h3 id="_savecontext-stores-the-current-parsing-context"><code>_saveContext</code> stores the current parsing context</h3>
<p>when entering a new scope (list, blank node, formula)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_saveContext</span>(<span class="hljs-params">type, graph, subject, predicate, object</span>) {
    <span class="hljs-keyword">const</span> n3Mode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>.<span class="hljs-title function_">push</span>({
      type,
      subject, predicate, object, graph,
      <span class="hljs-attr">inverse</span>: n3Mode ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> : <span class="hljs-literal">false</span>,
      <span class="hljs-attr">blankPrefix</span>: n3Mode ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>.<span class="hljs-property">_</span> : <span class="hljs-string">&#x27;&#x27;</span>,
      <span class="hljs-attr">quantified</span>: n3Mode ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span> : <span class="hljs-literal">null</span>,
    });</pre></div></div>
            
        </li>
        
        
        <li id="section-16">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-16">&#x00a7;</a>
              </div>
              <p>The settings below only apply to N3 streams</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (n3Mode) {</pre></div></div>
            
        </li>
        
        
        <li id="section-17">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-17">&#x00a7;</a>
              </div>
              <p>Every new scope resets the predicate direction</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> = <span class="hljs-literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-18">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-18">&#x00a7;</a>
              </div>
              <p>In N3, blank nodes are scoped to a formula
(using a dot as separator, as a blank node label cannot start with it)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>.<span class="hljs-property">_</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> ? <span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._graph.id.substr(<span class="hljs-number">2</span>)}</span>.`</span> : <span class="hljs-string">&#x27;.&#x27;</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-19">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-19">&#x00a7;</a>
              </div>
              <p>Quantifiers are scoped to a formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span>);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-20">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-20">&#x00a7;</a>
              </div>
              <h3 id="_restorecontext-restores-the-parent-context"><code>_restoreContext</code> restores the parent context</h3>
<p>when leaving a scope (list, blank node, formula)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_restoreContext</span>(<span class="hljs-params">type, token</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-21">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-21">&#x00a7;</a>
              </div>
              <p>Obtain the previous context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>.<span class="hljs-title function_">pop</span>();
    <span class="hljs-keyword">if</span> (!context || context.<span class="hljs-property">type</span> !== type)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Unexpected <span class="hljs-subst">${token.type}</span>`</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-22">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-22">&#x00a7;</a>
              </div>
              <p>Restore the quad of the previous context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>   = context.<span class="hljs-property">subject</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = context.<span class="hljs-property">predicate</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>    = context.<span class="hljs-property">object</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>     = context.<span class="hljs-property">graph</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-23">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-23">&#x00a7;</a>
              </div>
              <p>Restore N3 context settings</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> = context.<span class="hljs-property">inverse</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>.<span class="hljs-property">_</span> = context.<span class="hljs-property">blankPrefix</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span> = context.<span class="hljs-property">quantified</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-24">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-24">&#x00a7;</a>
              </div>
              <h3 id="_readintopcontext-reads-a-token-when-in-the-top-context"><code>_readInTopContext</code> reads a token when in the top context</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readInTopContext</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-25">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-25">&#x00a7;</a>
              </div>
              <p>If an EOF token arrives in the top context, signal that we’re done</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;eof&#x27;</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> !== <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unclosed graph&#x27;</span>, token);
      <span class="hljs-keyword">delete</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>.<span class="hljs-property">_</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-26">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-26">&#x00a7;</a>
              </div>
              <p>It could be a prefix declaration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;PREFIX&#x27;</span>:
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sparqlStyle</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;@prefix&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPrefix</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-27">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-27">&#x00a7;</a>
              </div>
              <p>It could be a base declaration</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;BASE&#x27;</span>:
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sparqlStyle</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;@base&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBaseIRI</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-28">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-28">&#x00a7;</a>
              </div>
              <p>It could be a graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;{&#x27;</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsNamedGraphs</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-string">&#x27;&#x27;</span>;
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
      }
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;GRAPH&#x27;</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsNamedGraphs</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readNamedGraphLabel</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-29">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-29">&#x00a7;</a>
              </div>
              <p>Otherwise, the next token must be a subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readSubject</span>(token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-30">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-30">&#x00a7;</a>
              </div>
              <h3 id="_readentity-reads-an-iri-prefixed-name-blank-node-or-variable"><code>_readEntity</code> reads an IRI, prefixed name, blank node, or variable</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readEntity</span>(<span class="hljs-params">token, quantifier</span>) {
    <span class="hljs-keyword">let</span> value;
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-31">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-31">&#x00a7;</a>
              </div>
              <p>Read a relative or absolute IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;IRI&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;typeIRI&#x27;</span>:
      <span class="hljs-keyword">const</span> iri = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_resolveIRI</span>(token.<span class="hljs-property">value</span>);
      <span class="hljs-keyword">if</span> (iri === <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Invalid IRI&#x27;</span>, token);
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_namedNode</span>(iri);
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-32">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-32">&#x00a7;</a>
              </div>
              <p>Read a prefixed name</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;type&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;prefixed&#x27;</span>:
      <span class="hljs-keyword">const</span> prefix = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>[token.<span class="hljs-property">prefix</span>];
      <span class="hljs-keyword">if</span> (prefix === <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Undefined prefix &quot;<span class="hljs-subst">${token.prefix}</span>:&quot;`</span>, token);
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_namedNode</span>(prefix + token.<span class="hljs-property">value</span>);
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-33">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-33">&#x00a7;</a>
              </div>
              <p>Read a blank node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;blank&#x27;</span>:
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>[token.<span class="hljs-property">prefix</span>] + token.<span class="hljs-property">value</span>);
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-34">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-34">&#x00a7;</a>
              </div>
              <p>Read a variable</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;var&#x27;</span>:
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_variable</span>(token.<span class="hljs-property">value</span>.<span class="hljs-title function_">substr</span>(<span class="hljs-number">1</span>));
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-35">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-35">&#x00a7;</a>
              </div>
              <p>Everything else is not an entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected entity but got <span class="hljs-subst">${token.type}</span>`</span>, token);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-36">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-36">&#x00a7;</a>
              </div>
              <p>In N3 mode, replace the entity if it is quantified</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!quantifier &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span> &amp;&amp; (value.<span class="hljs-property">id</span> <span class="hljs-keyword">in</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span>))
      value = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span>[value.<span class="hljs-property">id</span>];
    <span class="hljs-keyword">return</span> value;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-37">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-37">&#x00a7;</a>
              </div>
              <h3 id="_readsubject-reads-a-quads-subject"><code>_readSubject</code> reads a quad’s subject</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readSubject</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-38">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-38">&#x00a7;</a>
              </div>
              <p>Start a new quad with a new blank node as subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;blank&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBlankNodeHead</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;(&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-39">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-39">&#x00a7;</a>
              </div>
              <p>Start a new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;list&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItem</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;{&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-40">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-40">&#x00a7;</a>
              </div>
              <p>Start a new formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected graph&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;formula&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;}&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-41">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-41">&#x00a7;</a>
              </div>
              <p>No subject; the graph in which we are reading is closed instead</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPunctuation</span>(token);
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;@forSome&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected &quot;@forSome&quot;&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">N3_FORSOME</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantifier</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_blankNode</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readQuantifierList</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;@forAll&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected &quot;@forAll&quot;&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">N3_FORALL</span>;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantifier</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_variable</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readQuantifierList</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;literal&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected literal&#x27;</span>, token);

      <span class="hljs-keyword">if</span> (token.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span> = token.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_completeSubjectLiteral</span>;
      }
      <span class="hljs-keyword">else</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(token.<span class="hljs-property">value</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_namedNode</span>(token.<span class="hljs-property">prefix</span>));

      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsRDFStar</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected RDF* syntax&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
    <span class="hljs-attr">default</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-42">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-42">&#x00a7;</a>
              </div>
              <p>Read the subject entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-43">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-43">&#x00a7;</a>
              </div>
              <p>In N3 mode, the subject might be a path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getPathReader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateOrNamedGraph</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-44">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-44">&#x00a7;</a>
              </div>
              <p>The next token must be a predicate,
or, if the subject was actually a graph IRI, a named graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateOrNamedGraph</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-45">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-45">&#x00a7;</a>
              </div>
              <h3 id="_readpredicate-reads-a-quads-predicate"><code>_readPredicate</code> reads a quad’s predicate</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPredicate</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">const</span> type = token.<span class="hljs-property">type</span>;
    <span class="hljs-keyword">switch</span> (type) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;inverse&#x27;</span>:
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;abbreviation&#x27;</span>:
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">ABBREVIATIONS</span>[token.<span class="hljs-property">value</span>];
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;]&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;}&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-46">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-46">&#x00a7;</a>
              </div>
              <p>Expected predicate didn’t come, must have been trailing semicolon</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> === <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Unexpected <span class="hljs-subst">${type}</span>`</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> type === <span class="hljs-string">&#x27;]&#x27;</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readBlankNodeTail</span>(token) : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPunctuation</span>(token);
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;;&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-47">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-47">&#x00a7;</a>
              </div>
              <p>Additional semicolons can be safely ignored</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> !== <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span> :
             <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Expected predicate but got ;&#x27;</span>, token);
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-48">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-48">&#x00a7;</a>
              </div>
              <p>Start a new quad with a new blank node as subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;blank&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>,
                          <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-literal">null</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBlankNodeHead</span>;
      }
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;blank&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Disallowed blank node as predicate&#x27;</span>, token);
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-49">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-49">&#x00a7;</a>
              </div>
              <p>The next token must be an object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readObject</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-50">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-50">&#x00a7;</a>
              </div>
              <h3 id="_readobject-reads-a-quads-object"><code>_readObject</code> reads a quad’s object</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readObject</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;literal&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-51">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-51">&#x00a7;</a>
              </div>
              <p>Regular literal, can still get a datatype or language</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (token.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span> = token.<span class="hljs-property">value</span>;
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readDataTypeOrLang</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-52">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-52">&#x00a7;</a>
              </div>
              <p>Pre-datatyped string literal (prefix stores the datatype)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(token.<span class="hljs-property">value</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_namedNode</span>(token.<span class="hljs-property">prefix</span>));
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-53">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-53">&#x00a7;</a>
              </div>
              <p>Start a new quad with a new blank node as subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;blank&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>());
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBlankNodeHead</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;(&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-54">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-54">&#x00a7;</a>
              </div>
              <p>Start a new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;list&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItem</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;{&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-55">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-55">&#x00a7;</a>
              </div>
              <p>Start a new formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected graph&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;formula&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>());
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>:
      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsRDFStar</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected RDF* syntax&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-literal">null</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
    <span class="hljs-attr">default</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-56">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-56">&#x00a7;</a>
              </div>
              <p>Read the object entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> ((<span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-57">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-57">&#x00a7;</a>
              </div>
              <p>In N3 mode, the object might be a path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getPathReader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>());
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-58">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-58">&#x00a7;</a>
              </div>
              <h3 id="_readpredicateornamedgraph-reads-a-quads-predicate-or-a-named-graph"><code>_readPredicateOrNamedGraph</code> reads a quad’s predicate, or a named graph</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPredicateOrNamedGraph</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">return</span> token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;{&#x27;</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readGraph</span>(token) : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPredicate</span>(token);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-59">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-59">&#x00a7;</a>
              </div>
              <h3 id="_readgraph-reads-a-graph"><code>_readGraph</code> reads a graph</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readGraph</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;{&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected graph but got <span class="hljs-subst">${token.type}</span>`</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-60">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-60">&#x00a7;</a>
              </div>
              <p>The “subject” we read is actually the GRAPH’s label</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-61">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-61">&#x00a7;</a>
              </div>
              <h3 id="_readblanknodehead-reads-the-head-of-a-blank-node"><code>_readBlankNodeHead</code> reads the head of a blank node</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readBlankNodeHead</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;]&#x27;</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readBlankNodeTail</span>(token);
    }
    <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPredicate</span>(token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-62">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-62">&#x00a7;</a>
              </div>
              <h3 id="_readblanknodetail-reads-the-end-of-a-blank-node"><code>_readBlankNodeTail</code> reads the end of a blank node</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readBlankNodeTail</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;]&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readBlankNodePunctuation</span>(token);</pre></div></div>
            
        </li>
        
        
        <li id="section-63">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-63">&#x00a7;</a>
              </div>
              <p>Store blank node quad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> !== <span class="hljs-literal">null</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-64">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-64">&#x00a7;</a>
              </div>
              <p>Restore the parent context containing this blank node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> empty = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> === <span class="hljs-literal">null</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_restoreContext</span>(<span class="hljs-string">&#x27;blank&#x27;</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-65">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-65">&#x00a7;</a>
              </div>
              <p>If the blank node was the object, restore previous context and read punctuation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> !== <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-66">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-66">&#x00a7;</a>
              </div>
              <p>If the blank node was the predicate, continue reading the object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> !== <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readObject</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-67">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-67">&#x00a7;</a>
              </div>
              <p>If the blank node was the subject, continue reading the predicate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span></pre></div></div>
            
        </li>
        
        
        <li id="section-68">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-68">&#x00a7;</a>
              </div>
              <p>If the blank node was empty, it could be a named graph label</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> empty ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateOrNamedGraph</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateAfterBlank</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-69">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-69">&#x00a7;</a>
              </div>
              <h3 id="_readpredicateafterblank-reads-a-predicate-after-an-anonymous-blank-node"><code>_readPredicateAfterBlank</code> reads a predicate after an anonymous blank node</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPredicateAfterBlank</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;}&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-70">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-70">&#x00a7;</a>
              </div>
              <p>No predicate is coming if the triple is terminated here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPunctuation</span>(token);
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPredicate</span>(token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-71">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-71">&#x00a7;</a>
              </div>
              <h3 id="_readlistitem-reads-items-from-a-list"><code>_readListItem</code> reads items from a list</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readListItem</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">let</span> item = <span class="hljs-literal">null</span>,                      <span class="hljs-comment">// The item of the list</span>
        list = <span class="hljs-literal">null</span>,                      <span class="hljs-comment">// The list itself</span>
        next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItem</span>;        <span class="hljs-comment">// The next function to execute</span>
    <span class="hljs-keyword">const</span> previousList = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>,   <span class="hljs-comment">// The previous list that contains this list</span>
        stack = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>,       <span class="hljs-comment">// The stack of parent contexts</span>
        parent = stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>]; <span class="hljs-comment">// The parent containing the current list</span>

    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-72">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-72">&#x00a7;</a>
              </div>
              <p>Stack the current list quad and start a new quad with a blank node as subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;blank&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>,
                        list = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = item = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>());
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBlankNodeHead</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;(&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-73">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-73">&#x00a7;</a>
              </div>
              <p>Stack the current list quad and start a new list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;list&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>,
                        list = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;)&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-74">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-74">&#x00a7;</a>
              </div>
              <p>Closing the list; restore the parent context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_restoreContext</span>(<span class="hljs-string">&#x27;list&#x27;</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-75">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-75">&#x00a7;</a>
              </div>
              <p>If this list is contained within a parent list, return the membership quad here.
This will be <code>&lt;parent list element&gt; rdf:first &lt;this list&gt;.</code>.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (stack.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span> &amp;&amp; stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;list&#x27;</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-76">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-76">&#x00a7;</a>
              </div>
              <p>Was this list the parent’s subject?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> === <span class="hljs-literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-77">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-77">&#x00a7;</a>
              </div>
              <p>The next token is the predicate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-78">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-78">&#x00a7;</a>
              </div>
              <p>No list tail if this was an empty list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>)
          <span class="hljs-keyword">return</span> next;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-79">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-79">&#x00a7;</a>
              </div>
              <p>The list was in the parent context’s object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> {
        next = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-80">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-80">&#x00a7;</a>
              </div>
              <p>No list tail if this was an empty list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> === <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>)
          <span class="hljs-keyword">return</span> next;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-81">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-81">&#x00a7;</a>
              </div>
              <p>Close the list by making the head nil</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      list = <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;literal&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-82">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-82">&#x00a7;</a>
              </div>
              <p>Regular literal, can still get a datatype or language</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (token.<span class="hljs-property">prefix</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span> = token.<span class="hljs-property">value</span>;
        next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItemDataTypeOrLang</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-83">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-83">&#x00a7;</a>
              </div>
              <p>Pre-datatyped string literal (prefix stores the datatype)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span> {
        item = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(token.<span class="hljs-property">value</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_namedNode</span>(token.<span class="hljs-property">prefix</span>));
        next = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
      }
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;{&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-84">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-84">&#x00a7;</a>
              </div>
              <p>Start a new formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected graph&#x27;</span>, token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;formula&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>,
                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>());
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">if</span> ((item = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-85">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-85">&#x00a7;</a>
              </div>
              <p>Create a new blank node if no item head was assigned yet</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (list === <span class="hljs-literal">null</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = list = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-86">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-86">&#x00a7;</a>
              </div>
              <p>Is this the first element of the list?</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (previousList === <span class="hljs-literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-87">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-87">&#x00a7;</a>
              </div>
              <p>This list is either the subject or the object of its parent</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (parent.<span class="hljs-property">predicate</span> === <span class="hljs-literal">null</span>)
        parent.<span class="hljs-property">subject</span> = list;
      <span class="hljs-keyword">else</span>
        parent.<span class="hljs-property">object</span> = list;
    }
    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-88">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-88">&#x00a7;</a>
              </div>
              <p>Continue the previous list with the current list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(previousList, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_REST</span>, list, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-89">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-89">&#x00a7;</a>
              </div>
              <p>If an item was read, add it to the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (item !== <span class="hljs-literal">null</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-90">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-90">&#x00a7;</a>
              </div>
              <p>In N3 mode, the item might be a path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span> &amp;&amp; (token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;IRI&#x27;</span> || token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;prefixed&#x27;</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-91">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-91">&#x00a7;</a>
              </div>
              <p>Create a new context to add the item’s path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_saveContext</span>(<span class="hljs-string">&#x27;item&#x27;</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>, list, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, item);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = item, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-92">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-92">&#x00a7;</a>
              </div>
              <p>_readPath will restore the context and output the item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getPathReader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItem</span>);
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-93">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-93">&#x00a7;</a>
              </div>
              <p>Output the item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(list, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, item, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
    }
    <span class="hljs-keyword">return</span> next;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-94">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-94">&#x00a7;</a>
              </div>
              <h3 id="_readdatatypeorlang-reads-an-optional-datatype-or-language"><code>_readDataTypeOrLang</code> reads an <em>optional</em> datatype or language</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readDataTypeOrLang</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_completeObjectLiteral</span>(token, <span class="hljs-literal">false</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-95">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-95">&#x00a7;</a>
              </div>
              <h3 id="_readlistitemdatatypeorlang-reads-an-optional-datatype-or-language-in-a-list"><code>_readListItemDataTypeOrLang</code> reads an <em>optional</em> datatype or language in a list</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readListItemDataTypeOrLang</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_completeObjectLiteral</span>(token, <span class="hljs-literal">true</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-96">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-96">&#x00a7;</a>
              </div>
              <h3 id="_completeliteral-completes-a-literal-with-an-optional-datatype-or-language"><code>_completeLiteral</code> completes a literal with an optional datatype or language</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_completeLiteral</span>(<span class="hljs-params">token</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-97">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-97">&#x00a7;</a>
              </div>
              <p>Create a simple string literal by default</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">let</span> literal = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span>);

    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-98">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-98">&#x00a7;</a>
              </div>
              <p>Create a datatyped literal</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;type&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;typeIRI&#x27;</span>:
      <span class="hljs-keyword">const</span> datatype = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token);
      <span class="hljs-keyword">if</span> (datatype === <span class="hljs-literal">undefined</span>) <span class="hljs-keyword">return</span>; <span class="hljs-comment">// No datatype means an error occurred</span>
      literal = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span>, datatype);
      token = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-99">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-99">&#x00a7;</a>
              </div>
              <p>Create a language-tagged string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;langcode&#x27;</span>:
      literal = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_literal</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_literalValue</span>, token.<span class="hljs-property">value</span>);
      token = <span class="hljs-literal">null</span>;
      <span class="hljs-keyword">break</span>;
    }

    <span class="hljs-keyword">return</span> { token, literal };
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-100">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-100">&#x00a7;</a>
              </div>
              <p>Completes a literal in subject position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_completeSubjectLiteral</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_completeLiteral</span>(token).<span class="hljs-property">literal</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicateOrNamedGraph</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-101">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-101">&#x00a7;</a>
              </div>
              <p>Completes a literal in object position</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_completeObjectLiteral</span>(<span class="hljs-params">token, listItem</span>) {
    <span class="hljs-keyword">const</span> completed = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_completeLiteral</span>(token);
    <span class="hljs-keyword">if</span> (!completed)
      <span class="hljs-keyword">return</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> = completed.<span class="hljs-property">literal</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-102">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-102">&#x00a7;</a>
              </div>
              <p>If this literal was part of a list, write the item
(we could also check the context stack, but passing in a flag is faster)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (listItem)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-103">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-103">&#x00a7;</a>
              </div>
              <p>If the token was consumed, continue with the rest of the input</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (completed.<span class="hljs-property">token</span> === <span class="hljs-literal">null</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-104">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-104">&#x00a7;</a>
              </div>
              <p>Otherwise, consume the token now</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readCallback</span>(completed.<span class="hljs-property">token</span>);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-105">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-105">&#x00a7;</a>
              </div>
              <h3 id="_readformulatail-reads-the-end-of-a-formula"><code>_readFormulaTail</code> reads the end of a formula</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readFormulaTail</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;}&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readPunctuation</span>(token);</pre></div></div>
            
        </li>
        
        
        <li id="section-106">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-106">&#x00a7;</a>
              </div>
              <p>Store the last quad of the formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> !== <span class="hljs-literal">null</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-107">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-107">&#x00a7;</a>
              </div>
              <p>Restore the parent context containing this formula</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_restoreContext</span>(<span class="hljs-string">&#x27;formula&#x27;</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-108">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-108">&#x00a7;</a>
              </div>
              <p>If the formula was the subject, continue reading the predicate.
If the formula was the object, read punctuation.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> === <span class="hljs-literal">null</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-109">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-109">&#x00a7;</a>
              </div>
              <h3 id="_readpunctuation-reads-punctuation-between-quads-or-quad-parts"><code>_readPunctuation</code> reads punctuation between quads or quad parts</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPunctuation</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">let</span> next, graph = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>;
    <span class="hljs-keyword">const</span> subject = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, inversePredicate = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span>;
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-110">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-110">&#x00a7;</a>
              </div>
              <p>A closing brace ends a graph</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;}&#x27;</span>:
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> === <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Unexpected graph closing&#x27;</span>, token);
      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_n3Mode</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readFormulaTail</span>(token);
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-literal">null</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-111">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-111">&#x00a7;</a>
              </div>
              <p>A dot just ends the statement, without sharing anything with the next</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>.<span class="hljs-property">length</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readSubject</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readInTopContext</span>;
      <span class="hljs-keyword">if</span> (inversePredicate) <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-112">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-112">&#x00a7;</a>
              </div>
              <p>Semicolon means the subject is shared; predicate and object are different</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;;&#x27;</span>:
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span>;
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-113">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-113">&#x00a7;</a>
              </div>
              <p>Comma means both the subject and predicate are shared; the object is different</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;,&#x27;</span>:
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readObject</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-114">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-114">&#x00a7;</a>
              </div>
              <p>An entity means this is a quad (only allowed if not already inside a graph)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsQuads</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> === <span class="hljs-literal">null</span> &amp;&amp; (graph = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) !== <span class="hljs-literal">undefined</span>) {
        next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readQuadPunctuation</span>;
        <span class="hljs-keyword">break</span>;
      }
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected punctuation to follow &quot;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._object.id}</span>&quot;`</span>, token);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-115">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-115">&#x00a7;</a>
              </div>
              <p>A quad has been completed now, so return it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (subject !== <span class="hljs-literal">null</span>) {
      <span class="hljs-keyword">const</span> predicate = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, object = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>;
      <span class="hljs-keyword">if</span> (!inversePredicate)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(subject, predicate, object,  graph);
      <span class="hljs-keyword">else</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(object,  predicate, subject, graph);
    }
    <span class="hljs-keyword">return</span> next;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-116">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-116">&#x00a7;</a>
              </div>
              <h3 id="_readblanknodepunctuation-reads-punctuation-in-a-blank-node"><code>_readBlankNodePunctuation</code> reads punctuation in a blank node</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readBlankNodePunctuation</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">let</span> next;
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-117">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-117">&#x00a7;</a>
              </div>
              <p>Semicolon means the subject is shared; predicate and object are different</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;;&#x27;</span>:
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span>;
      <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-118">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-118">&#x00a7;</a>
              </div>
              <p>Comma means both the subject and predicate are shared; the object is different</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;,&#x27;</span>:
      next = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readObject</span>;
      <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected punctuation to follow &quot;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._object.id}</span>&quot;`</span>, token);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-119">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-119">&#x00a7;</a>
              </div>
              <p>A quad has been completed now, so return it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
    <span class="hljs-keyword">return</span> next;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-120">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-120">&#x00a7;</a>
              </div>
              <h3 id="_readquadpunctuation-reads-punctuation-after-a-quad"><code>_readQuadPunctuation</code> reads punctuation after a quad</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readQuadPunctuation</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;.&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Expected dot to follow quad&#x27;</span>, token);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readInTopContext</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-121">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-121">&#x00a7;</a>
              </div>
              <h3 id="_readprefix-reads-the-prefix-of-a-prefix-declaration"><code>_readPrefix</code> reads the prefix of a prefix declaration</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPrefix</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;prefix&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Expected prefix to follow @prefix&#x27;</span>, token);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefix</span> = token.<span class="hljs-property">value</span>;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPrefixIRI</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-122">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-122">&#x00a7;</a>
              </div>
              <h3 id="_readprefixiri-reads-the-iri-of-a-prefix-declaration"><code>_readPrefixIRI</code> reads the IRI of a prefix declaration</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPrefixIRI</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;IRI&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected IRI to follow prefix &quot;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._prefix}</span>:&quot;`</span>, token);
    <span class="hljs-keyword">const</span> prefixNode = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefix</span>] = prefixNode.<span class="hljs-property">value</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_prefixCallback</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefix</span>, prefixNode);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readDeclarationPunctuation</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-123">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-123">&#x00a7;</a>
              </div>
              <h3 id="_readbaseiri-reads-the-iri-of-a-base-declaration"><code>_readBaseIRI</code> reads the IRI of a base declaration</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readBaseIRI</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">const</span> iri = token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;IRI&#x27;</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_resolveIRI</span>(token.<span class="hljs-property">value</span>);
    <span class="hljs-keyword">if</span> (!iri)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Expected valid IRI to follow base declaration&#x27;</span>, token);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_setBase</span>(iri);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readDeclarationPunctuation</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-124">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-124">&#x00a7;</a>
              </div>
              <h3 id="_readnamedgraphlabel-reads-the-label-of-a-named-graph"><code>_readNamedGraphLabel</code> reads the label of a named graph</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readNamedGraphLabel</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;IRI&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;blank&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;prefixed&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readSubject</span>(token), <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readGraph</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readNamedGraphBlankLabel</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Invalid graph label&#x27;</span>, token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-125">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-125">&#x00a7;</a>
              </div>
              <h3 id="_readnamedgraphlabel-reads-a-blank-node-label-of-a-named-graph"><code>_readNamedGraphLabel</code> reads a blank node label of a named graph</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readNamedGraphBlankLabel</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;]&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Invalid graph label&#x27;</span>, token);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>();
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readGraph</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-126">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-126">&#x00a7;</a>
              </div>
              <h3 id="_readdeclarationpunctuation-reads-the-punctuation-of-a-declaration"><code>_readDeclarationPunctuation</code> reads the punctuation of a declaration</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readDeclarationPunctuation</span>(<span class="hljs-params">token</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-127">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-127">&#x00a7;</a>
              </div>
              <p>SPARQL-style declarations don’t have punctuation</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_sparqlStyle</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sparqlStyle</span> = <span class="hljs-literal">false</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readInTopContext</span>(token);
    }

    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;.&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">&#x27;Expected declaration to end with a dot&#x27;</span>, token);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readInTopContext</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-128">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-128">&#x00a7;</a>
              </div>
              <p>Reads a list of quantified symbols from a @forSome or @forAll statement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readQuantifierList</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">let</span> entity;
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;IRI&#x27;</span>:
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;prefixed&#x27;</span>:
      <span class="hljs-keyword">if</span> ((entity = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token, <span class="hljs-literal">true</span>)) !== <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">break</span>;
    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Unexpected <span class="hljs-subst">${token.type}</span>`</span>, token);
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-129">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-129">&#x00a7;</a>
              </div>
              <p>Without explicit quantifiers, map entities to a quantified entity</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-variable language_">this</span>.<span class="hljs-property">_explicitQuantifiers</span>)
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span>[entity.<span class="hljs-property">id</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_quantifier</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>().<span class="hljs-property">value</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-130">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-130">&#x00a7;</a>
              </div>
              <p>With explicit quantifiers, output the reified quantifier</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-131">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-131">&#x00a7;</a>
              </div>
              <p>If this is the first item, start a new quantifier list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> === <span class="hljs-literal">null</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">DEFAULTGRAPH</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>,
                   <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">QUANTIFIERS_GRAPH</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-132">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-132">&#x00a7;</a>
              </div>
              <p>Otherwise, continue the previous list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">else</span>
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_REST</span>,
                   <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>(), <span class="hljs-variable language_">this</span>.<span class="hljs-property">QUANTIFIERS_GRAPH</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-133">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-133">&#x00a7;</a>
              </div>
              <p>Output the list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, entity, <span class="hljs-variable language_">this</span>.<span class="hljs-property">QUANTIFIERS_GRAPH</span>);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readQuantifierPunctuation</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-134">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-134">&#x00a7;</a>
              </div>
              <p>Reads punctuation from a @forSome or @forAll statement</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readQuantifierPunctuation</span>(<span class="hljs-params">token</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-135">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-135">&#x00a7;</a>
              </div>
              <p>Read more quantifiers</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;,&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readQuantifierList</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-136">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-136">&#x00a7;</a>
              </div>
              <p>End of the quantifier list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {</pre></div></div>
            
        </li>
        
        
        <li id="section-137">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-137">&#x00a7;</a>
              </div>
              <p>With explicit quantifiers, close the quantifier list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_explicitQuantifiers</span>) {
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_REST</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_NIL</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">QUANTIFIERS_GRAPH</span>);
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = <span class="hljs-literal">null</span>;
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-138">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-138">&#x00a7;</a>
              </div>
              <p>Read a dot</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readCallback</span>(token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-139">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-139">&#x00a7;</a>
              </div>
              <h3 id="_getpathreader-reads-a-potential-path-and-then-resumes-with-the-given-function"><code>_getPathReader</code> reads a potential path and then resumes with the given function</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_getPathReader</span>(<span class="hljs-params">afterPath</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_afterPath</span> = afterPath;
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPath</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-140">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-140">&#x00a7;</a>
              </div>
              <h3 id="_readpath-reads-a-potential-path"><code>_readPath</code> reads a potential path</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readPath</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">switch</span> (token.<span class="hljs-property">type</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-141">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-141">&#x00a7;</a>
              </div>
              <p>Forward path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;!&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readForwardPath</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-142">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-142">&#x00a7;</a>
              </div>
              <p>Backward path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;^&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBackwardPath</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-143">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-143">&#x00a7;</a>
              </div>
              <p>Not a path; resume reading where we left off</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">default</span>:
      <span class="hljs-keyword">const</span> stack = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>, parent = stack.<span class="hljs-property">length</span> &amp;&amp; stack[stack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>];</pre></div></div>
            
        </li>
        
        
        <li id="section-144">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-144">&#x00a7;</a>
              </div>
              <p>If we were reading a list item, we still need to output it</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (parent &amp;&amp; parent.<span class="hljs-property">type</span> === <span class="hljs-string">&#x27;item&#x27;</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-145">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-145">&#x00a7;</a>
              </div>
              <p>The list item is the remaining subejct after reading the path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-keyword">const</span> item = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-146">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-146">&#x00a7;</a>
              </div>
              <p>Switch back to the context of the list</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_restoreContext</span>(<span class="hljs-string">&#x27;item&#x27;</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-147">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-147">&#x00a7;</a>
              </div>
              <p>Output the list item</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">RDF_FIRST</span>, item, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
      }
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_afterPath</span>(token);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-148">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-148">&#x00a7;</a>
              </div>
              <h3 id="_readforwardpath-reads-a--path"><code>_readForwardPath</code> reads a ‘!’ path</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readForwardPath</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">let</span> subject, predicate;
    <span class="hljs-keyword">const</span> object = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-149">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-149">&#x00a7;</a>
              </div>
              <p>The next token is the predicate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((predicate = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
      <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-150">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-150">&#x00a7;</a>
              </div>
              <p>If we were reading a subject, replace the subject by the path’s object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> === <span class="hljs-literal">null</span>)
      subject = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = object;</pre></div></div>
            
        </li>
        
        
        <li id="section-151">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-151">&#x00a7;</a>
              </div>
              <p>If we were reading an object, replace the subject by the path’s object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span>
      subject = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>  = object;</pre></div></div>
            
        </li>
        
        
        <li id="section-152">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-152">&#x00a7;</a>
              </div>
              <p>Emit the path’s current quad and read its next section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(subject, predicate, object, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPath</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-153">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-153">&#x00a7;</a>
              </div>
              <h3 id="_readbackwardpath-reads-a--path"><code>_readBackwardPath</code> reads a ‘^’ path</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readBackwardPath</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">const</span> subject = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_blankNode</span>();
    <span class="hljs-keyword">let</span> predicate, object;</pre></div></div>
            
        </li>
        
        
        <li id="section-154">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-154">&#x00a7;</a>
              </div>
              <p>The next token is the predicate</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> ((predicate = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) === <span class="hljs-literal">undefined</span>)
      <span class="hljs-keyword">return</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-155">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-155">&#x00a7;</a>
              </div>
              <p>If we were reading a subject, replace the subject by the path’s subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span> === <span class="hljs-literal">null</span>)
      object = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = subject;</pre></div></div>
            
        </li>
        
        
        <li id="section-156">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-156">&#x00a7;</a>
              </div>
              <p>If we were reading an object, replace the subject by the path’s subject</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span>
      object = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>,  <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>  = subject;</pre></div></div>
            
        </li>
        
        
        <li id="section-157">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-157">&#x00a7;</a>
              </div>
              <p>Emit the path’s current quad and read its next section</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_emit</span>(subject, predicate, object, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPath</span>;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-158">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-158">&#x00a7;</a>
              </div>
              <h3 id="_readrdfstartailorgraph-reads-the-graph-of-a-nested-rdf-quad-or-the-end-of-a-nested-rdf-triple"><code>_readRDFStarTailOrGraph</code> reads the graph of a nested RDF* quad or the end of a nested RDF* triple</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readRDFStarTailOrGraph</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-159">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-159">&#x00a7;</a>
              </div>
              <p>An entity means this is a quad (only allowed if not already inside a graph)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_supportsQuads</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> === <span class="hljs-literal">null</span> &amp;&amp; (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readEntity</span>(token)) !== <span class="hljs-literal">undefined</span>)
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readRDFStarTail</span>;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected &gt;&gt; to follow &quot;<span class="hljs-subst">${<span class="hljs-variable language_">this</span>._object.id}</span>&quot;`</span>, token);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readRDFStarTail</span>(token);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-160">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-160">&#x00a7;</a>
              </div>
              <h3 id="_readrdfstartail-reads-the-end-of-a-nested-rdf-triple"><code>_readRDFStarTail</code> reads the end of a nested RDF* triple</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_readRDFStarTail</span>(<span class="hljs-params">token</span>) {
    <span class="hljs-keyword">if</span> (token.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;&gt;&gt;&#x27;</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_error</span>(<span class="hljs-string">`Expected &gt;&gt; but got <span class="hljs-subst">${token.type}</span>`</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-161">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-161">&#x00a7;</a>
              </div>
              <p>Read the quad and restore the previous context</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> quad = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_quad</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_predicate</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span>,
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_graph</span> || <span class="hljs-variable language_">this</span>.<span class="hljs-property">DEFAULTGRAPH</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_restoreContext</span>(<span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>, token);</pre></div></div>
            
        </li>
        
        
        <li id="section-162">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-162">&#x00a7;</a>
              </div>
              <p>If the triple was the subject, continue by reading the predicate.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> === <span class="hljs-literal">null</span>) {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_subject</span> = quad;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPredicate</span>;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-163">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-163">&#x00a7;</a>
              </div>
              <p>If the triple was the object, read context end.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">else</span> {
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_object</span> = quad;
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_getContextEndReader</span>();
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-164">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-164">&#x00a7;</a>
              </div>
              <h3 id="_getcontextendreader-gets-the-next-reader-function-at-the-end-of-a-context"><code>_getContextEndReader</code> gets the next reader function at the end of a context</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_getContextEndReader</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">const</span> contextStack = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_contextStack</span>;
    <span class="hljs-keyword">if</span> (!contextStack.<span class="hljs-property">length</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readPunctuation</span>;

    <span class="hljs-keyword">switch</span> (contextStack[contextStack.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>].<span class="hljs-property">type</span>) {
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;blank&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readBlankNodeTail</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;list&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readListItem</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;formula&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readFormulaTail</span>;
    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&lt;&#x27;</span>:
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readRDFStarTailOrGraph</span>;
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-165">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-165">&#x00a7;</a>
              </div>
              <h3 id="_emit-sends-a-quad-through-the-callback"><code>_emit</code> sends a quad through the callback</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_emit</span>(<span class="hljs-params">subject, predicate, object, graph</span>) {
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_callback</span>(<span class="hljs-literal">null</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_quad</span>(subject, predicate, object, graph || <span class="hljs-variable language_">this</span>.<span class="hljs-property">DEFAULTGRAPH</span>));
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-166">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-166">&#x00a7;</a>
              </div>
              <h3 id="_error-emits-an-error-message-through-the-callback"><code>_error</code> emits an error message through the callback</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_error</span>(<span class="hljs-params">message, token</span>) {
    <span class="hljs-keyword">const</span> err = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">`<span class="hljs-subst">${message}</span> on line <span class="hljs-subst">${token.line}</span>.`</span>);
    err.<span class="hljs-property">context</span> = {
      <span class="hljs-attr">token</span>: token,
      <span class="hljs-attr">line</span>: token.<span class="hljs-property">line</span>,
      <span class="hljs-attr">previousToken</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">_lexer</span>.<span class="hljs-property">previousToken</span>,
    };
    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_callback</span>(err);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_callback</span> = noop;
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-167">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-167">&#x00a7;</a>
              </div>
              <h3 id="_resolveiri-resolves-an-iri-against-the-base-path"><code>_resolveIRI</code> resolves an IRI against the base path</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_resolveIRI</span>(<span class="hljs-params">iri</span>) {
    <span class="hljs-keyword">return</span> <span class="hljs-regexp">/^[a-z][a-z0-9+.-]*:/i</span>.<span class="hljs-title function_">test</span>(iri) ? iri : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_resolveRelativeIRI</span>(iri);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-168">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-168">&#x00a7;</a>
              </div>
              <h3 id="_resolverelativeiri-resolves-an-iri-against-the-base-path"><code>_resolveRelativeIRI</code> resolves an IRI against the base path,</h3>
<p>assuming that a base path has been set and that the IRI is indeed relative</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_resolveRelativeIRI</span>(<span class="hljs-params">iri</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-169">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-169">&#x00a7;</a>
              </div>
              <p>An empty relative IRI indicates the base IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!iri.<span class="hljs-property">length</span>)
      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_base</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-170">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-170">&#x00a7;</a>
              </div>
              <p>Decide resolving strategy based in the first character</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">switch</span> (iri[<span class="hljs-number">0</span>]) {</pre></div></div>
            
        </li>
        
        
        <li id="section-171">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-171">&#x00a7;</a>
              </div>
              <p>Resolve relative fragment IRIs against the base IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;#&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_base</span> + iri;</pre></div></div>
            
        </li>
        
        
        <li id="section-172">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-172">&#x00a7;</a>
              </div>
              <p>Resolve relative query string IRIs by replacing the query string</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;?&#x27;</span>: <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_base</span>.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/(?:\?.*)?$/</span>, iri);</pre></div></div>
            
        </li>
        
        
        <li id="section-173">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-173">&#x00a7;</a>
              </div>
              <p>Resolve root-relative IRIs at the root of the base IRI</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-174">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-174">&#x00a7;</a>
              </div>
              <p>Resolve scheme-relative IRIs to the scheme</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> (iri[<span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;/&#x27;</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_baseScheme</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">_baseRoot</span>) + <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeDotSegments</span>(iri);</pre></div></div>
            
        </li>
        
        
        <li id="section-175">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-175">&#x00a7;</a>
              </div>
              <p>Resolve all other IRIs at the base IRI’s path</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-attr">default</span>:</pre></div></div>
            
        </li>
        
        
        <li id="section-176">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-176">&#x00a7;</a>
              </div>
              <p>Relative IRIs cannot contain a colon in the first path segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">return</span> (<span class="hljs-regexp">/^[^/:]*:/</span>.<span class="hljs-title function_">test</span>(iri)) ? <span class="hljs-literal">null</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_removeDotSegments</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">_basePath</span> + iri);
    }
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-177">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-177">&#x00a7;</a>
              </div>
              <h3 id="_removedotsegments-resolves--and--path-segments-in-an-iri-as-per-rfc3986"><code>_removeDotSegments</code> resolves ‘./‘ and ‘../‘ path segments in an IRI as per RFC3986</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">_removeDotSegments</span>(<span class="hljs-params">iri</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-178">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-178">&#x00a7;</a>
              </div>
              <p>Don’t modify the IRI if it does not contain any dot segments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!<span class="hljs-regexp">/(^|\/)\.\.?($|[/#?])/</span>.<span class="hljs-title function_">test</span>(iri))
      <span class="hljs-keyword">return</span> iri;</pre></div></div>
            
        </li>
        
        
        <li id="section-179">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-179">&#x00a7;</a>
              </div>
              <p>Start with an imaginary slash before the IRI in order to resolve trailing ‘./‘ and ‘../‘</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> length = iri.<span class="hljs-property">length</span>;
    <span class="hljs-keyword">let</span> result = <span class="hljs-string">&#x27;&#x27;</span>, i = -<span class="hljs-number">1</span>, pathStart = -<span class="hljs-number">1</span>, segmentStart = <span class="hljs-number">0</span>, next = <span class="hljs-string">&#x27;/&#x27;</span>;

    <span class="hljs-keyword">while</span> (i &lt; length) {
      <span class="hljs-keyword">switch</span> (next) {</pre></div></div>
            
        </li>
        
        
        <li id="section-180">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-180">&#x00a7;</a>
              </div>
              <p>The path starts with the first slash after the authority</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;:&#x27;</span>:
        <span class="hljs-keyword">if</span> (pathStart &lt; <span class="hljs-number">0</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-181">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-181">&#x00a7;</a>
              </div>
              <p>Skip two slashes before the authority</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">if</span> (iri[++i] === <span class="hljs-string">&#x27;/&#x27;</span> &amp;&amp; iri[++i] === <span class="hljs-string">&#x27;/&#x27;</span>)</pre></div></div>
            
        </li>
        
        
        <li id="section-182">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-182">&#x00a7;</a>
              </div>
              <p>Skip to slash after the authority</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>            <span class="hljs-keyword">while</span> ((pathStart = i + <span class="hljs-number">1</span>) &lt; length &amp;&amp; iri[pathStart] !== <span class="hljs-string">&#x27;/&#x27;</span>)
              i = pathStart;
        }
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-183">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-183">&#x00a7;</a>
              </div>
              <p>Don’t modify a query string or fragment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;?&#x27;</span>:
      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;#&#x27;</span>:
        i = length;
        <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-184">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-184">&#x00a7;</a>
              </div>
              <p>Handle ‘/.’ or ‘/..’ path segments</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:
        <span class="hljs-keyword">if</span> (iri[i + <span class="hljs-number">1</span>] === <span class="hljs-string">&#x27;.&#x27;</span>) {
          next = iri[++i + <span class="hljs-number">1</span>];
          <span class="hljs-keyword">switch</span> (next) {</pre></div></div>
            
        </li>
        
        
        <li id="section-185">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-185">&#x00a7;</a>
              </div>
              <p>Remove a ‘/.’ segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;/&#x27;</span>:
            result += iri.<span class="hljs-title function_">substring</span>(segmentStart, i - <span class="hljs-number">1</span>);
            segmentStart = i + <span class="hljs-number">1</span>;
            <span class="hljs-keyword">break</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-186">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-186">&#x00a7;</a>
              </div>
              <p>Remove a trailing ‘/.’ segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">case</span> <span class="hljs-attr">undefined</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;?&#x27;</span>:
          <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;#&#x27;</span>:
            <span class="hljs-keyword">return</span> result + iri.<span class="hljs-title function_">substring</span>(segmentStart, i) + iri.<span class="hljs-title function_">substr</span>(i + <span class="hljs-number">1</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-187">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-187">&#x00a7;</a>
              </div>
              <p>Remove a ‘/..’ segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:
            next = iri[++i + <span class="hljs-number">1</span>];
            <span class="hljs-keyword">if</span> (next === <span class="hljs-literal">undefined</span> || next === <span class="hljs-string">&#x27;/&#x27;</span> || next === <span class="hljs-string">&#x27;?&#x27;</span> || next === <span class="hljs-string">&#x27;#&#x27;</span>) {
              result += iri.<span class="hljs-title function_">substring</span>(segmentStart, i - <span class="hljs-number">2</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-188">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-188">&#x00a7;</a>
              </div>
              <p>Try to remove the parent path from result</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> ((segmentStart = result.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">&#x27;/&#x27;</span>)) &gt;= pathStart)
                result = result.<span class="hljs-title function_">substr</span>(<span class="hljs-number">0</span>, segmentStart);</pre></div></div>
            
        </li>
        
        
        <li id="section-189">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-189">&#x00a7;</a>
              </div>
              <p>Remove a trailing ‘/..’ segment</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>              <span class="hljs-keyword">if</span> (next !== <span class="hljs-string">&#x27;/&#x27;</span>)
                <span class="hljs-keyword">return</span> <span class="hljs-string">`<span class="hljs-subst">${result}</span>/<span class="hljs-subst">${iri.substr(i + <span class="hljs-number">1</span>)}</span>`</span>;
              segmentStart = i + <span class="hljs-number">1</span>;
            }
          }
        }
      }
      next = iri[++i];
    }
    <span class="hljs-keyword">return</span> result + iri.<span class="hljs-title function_">substring</span>(segmentStart);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-190">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-190">&#x00a7;</a>
              </div>
              <h2 id="public-methods">Public methods</h2>

            </div>
            
        </li>
        
        
        <li id="section-191">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-191">&#x00a7;</a>
              </div>
              <h3 id="parse-parses-the-n3-input-and-emits-each-parsed-quad-through-the-callback"><code>parse</code> parses the N3 input and emits each parsed quad through the callback</h3>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-title function_">parse</span>(<span class="hljs-params">input, quadCallback, prefixCallback</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-192">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-192">&#x00a7;</a>
              </div>
              <p>The read callback is the next function to be executed when a token arrives.
We start reading in the top context.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readInTopContext</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_sparqlStyle</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixes</span>.<span class="hljs-property">_</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">_blankNodePrefix</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">_blankNodePrefix</span>.<span class="hljs-title function_">substr</span>(<span class="hljs-number">2</span>)
                                             : <span class="hljs-string">`b<span class="hljs-subst">${blankNodePrefix++}</span>_`</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_prefixCallback</span> = prefixCallback || noop;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_inversePredicate</span> = <span class="hljs-literal">false</span>;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_quantified</span> = <span class="hljs-title class_">Object</span>.<span class="hljs-title function_">create</span>(<span class="hljs-literal">null</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-193">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-193">&#x00a7;</a>
              </div>
              <p>Parse synchronously if no quad callback is given</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">if</span> (!quadCallback) {
      <span class="hljs-keyword">const</span> quads = [];
      <span class="hljs-keyword">let</span> error;
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_callback</span> = <span class="hljs-function">(<span class="hljs-params">e, t</span>) =&gt;</span> { e ? (error = e) : t &amp;&amp; quads.<span class="hljs-title function_">push</span>(t); };
      <span class="hljs-variable language_">this</span>.<span class="hljs-property">_lexer</span>.<span class="hljs-title function_">tokenize</span>(input).<span class="hljs-title function_">every</span>(<span class="hljs-function"><span class="hljs-params">token</span> =&gt;</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readCallback</span>(token);
      });
      <span class="hljs-keyword">if</span> (error) <span class="hljs-keyword">throw</span> error;
      <span class="hljs-keyword">return</span> quads;
    }</pre></div></div>
            
        </li>
        
        
        <li id="section-194">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-194">&#x00a7;</a>
              </div>
              <p>Parse asynchronously otherwise, executing the read callback when a token arrives</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_callback</span> = quadCallback;
    <span class="hljs-variable language_">this</span>.<span class="hljs-property">_lexer</span>.<span class="hljs-title function_">tokenize</span>(input, <span class="hljs-function">(<span class="hljs-params">error, token</span>) =&gt;</span> {
      <span class="hljs-keyword">if</span> (error !== <span class="hljs-literal">null</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_callback</span>(error), <span class="hljs-variable language_">this</span>.<span class="hljs-property">_callback</span> = noop;
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span>)
        <span class="hljs-variable language_">this</span>.<span class="hljs-property">_readCallback</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">_readCallback</span>(token);
    });
  }
}</pre></div></div>
            
        </li>
        
        
        <li id="section-195">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-195">&#x00a7;</a>
              </div>
              <p>The empty function</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">function</span> <span class="hljs-title function_">noop</span>(<span class="hljs-params"></span>) {}</pre></div></div>
            
        </li>
        
        
        <li id="section-196">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-196">&#x00a7;</a>
              </div>
              <p>Initializes the parser with the given data factory</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">function</span> <span class="hljs-title function_">initDataFactory</span>(<span class="hljs-params">parser, factory</span>) {</pre></div></div>
            
        </li>
        
        
        <li id="section-197">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-197">&#x00a7;</a>
              </div>
              <p>Set factory methods</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> namedNode = factory.<span class="hljs-property">namedNode</span>;
  parser.<span class="hljs-property">_namedNode</span>   = namedNode;
  parser.<span class="hljs-property">_blankNode</span>   = factory.<span class="hljs-property">blankNode</span>;
  parser.<span class="hljs-property">_literal</span>     = factory.<span class="hljs-property">literal</span>;
  parser.<span class="hljs-property">_variable</span>    = factory.<span class="hljs-property">variable</span>;
  parser.<span class="hljs-property">_quad</span>        = factory.<span class="hljs-property">quad</span>;
  parser.<span class="hljs-property">DEFAULTGRAPH</span> = factory.<span class="hljs-title function_">defaultGraph</span>();</pre></div></div>
            
        </li>
        
        
        <li id="section-198">
            <div class="annotation">
              
              <div class="sswrap ">
                <a class="ss" href="#section-198">&#x00a7;</a>
              </div>
              <p>Set common named nodes</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  parser.<span class="hljs-property">RDF_FIRST</span>  = <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">first</span>);
  parser.<span class="hljs-property">RDF_REST</span>   = <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">rest</span>);
  parser.<span class="hljs-property">RDF_NIL</span>    = <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">nil</span>);
  parser.<span class="hljs-property">N3_FORALL</span>  = <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">r</span>.<span class="hljs-property">forAll</span>);
  parser.<span class="hljs-property">N3_FORSOME</span> = <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">r</span>.<span class="hljs-property">forSome</span>);
  parser.<span class="hljs-property">ABBREVIATIONS</span> = {
    <span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">rdf</span>.<span class="hljs-property">type</span>),
    <span class="hljs-string">&#x27;=&#x27;</span>: <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">owl</span>.<span class="hljs-property">sameAs</span>),
    <span class="hljs-string">&#x27;&gt;&#x27;</span>: <span class="hljs-title function_">namedNode</span>(namespaces.<span class="hljs-property">log</span>.<span class="hljs-property">implies</span>),
  };
  parser.<span class="hljs-property">QUANTIFIERS_GRAPH</span> = <span class="hljs-title function_">namedNode</span>(<span class="hljs-string">&#x27;urn:n3:quantifiers&#x27;</span>);
}
<span class="hljs-title function_">initDataFactory</span>(N3Parser.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>, N3DataFactory);</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
